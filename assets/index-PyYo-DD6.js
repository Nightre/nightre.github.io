(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class L{constructor(t=0,e){this.set(t,e)}set(t,e){return typeof t=="number"?e!==void 0?(this.x!==t||this.y!==e)&&(this.x=t,this.y=e):(this.x!==t||this.y!==t)&&(this.x=t,this.y=t):(this.x!==t.x||this.y!==t.y)&&(this.x=t.x,this.y=t.y),this}clone(){return new L(this.x,this.y)}add(t){return new L(this.x+t.x,this.y+t.y)}subtract(t){return new L(this.x-t.x,this.y-t.y)}multiplyScalar(t){return new L(this.x*t,this.y*t)}round(){return new L(Math.round(this.x),Math.round(this.y))}rotated(t){const e=Math.cos(t),i=Math.sin(t),s=this.x*e-this.y*i,r=this.x*i+this.y*e;return new L(s,r)}rotateAround(t,e){const i=this.x-e.x,s=this.y-e.y,r=Math.cos(t),o=Math.sin(t),l=i*r-s*o,a=i*o+s*r,u=l+e.x,f=a+e.y;return new L(u,f)}divideScalar(t){return t!==0?new L(this.x/t,this.y/t):new L(0,0)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){const t=this.length();return t>0?this.divideScalar(t):new L(0,0)}dot(t){return this.x*t.x+this.y*t.y}distanceTo(t){return Math.sqrt(this.distanceToSq(t))}distanceToSq(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}limit(t){return this.lengthSq()>t*t?this.normalize().multiplyScalar(t):this.clone()}angle(){return Math.atan2(this.y,this.x)}lerp(t,e){return new L(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}equals(t){return this.x===t.x&&this.y===t.y}static add(t,e){return new L(t.x+e.x,t.y+e.y)}static subtract(t,e){return new L(t.x-e.x,t.y-e.y)}static fromAngle(t){return new L(Math.cos(t),Math.sin(t))}toKey(){return`${this.x}_${this.y}`}isOpposite(t){return this.x===-t.x&&this.y===-t.y}inverted(){return new L(-this.x,-this.y)}perpendicular(){return new L(-this.y,this.x)}static quadraticBezier(t,e,i,s){const r=1-s,o=r*r*t.x+2*r*s*e.x+s*s*i.x,l=r*r*t.y+2*r*s*e.y+s*s*i.y;return new L(o,l)}moveTowards(t,e){const i=t.subtract(this);return i.length()<=e?t.clone():this.add(i.normalize().multiplyScalar(e))}}window.Vec2=L;function en(n,t,e=2){const i=t&&t.length,s=i?t[0]*e:n.length;let r=si(n,0,s,e,!0);const o=[];if(!r||r.next===r.prev)return o;let l,a,u;if(i&&(r=Di(n,t,r,e)),n.length>80*e){l=n[0],a=n[1];let f=l,c=a;for(let h=e;h<s;h+=e){const d=n[h],p=n[h+1];d<l&&(l=d),p<a&&(a=p),d>f&&(f=d),p>c&&(c=p)}u=Math.max(f-l,c-a),u=u!==0?32767/u:0}return xe(r,o,e,l,a,u,0),o}function si(n,t,e,i,s){let r;if(s===qi(n,t,e,i)>0)for(let o=t;o<e;o+=i)r=En(o/i|0,n[o],n[o+1],r);else for(let o=e-i;o>=t;o-=i)r=En(o/i|0,n[o],n[o+1],r);return r&&se(r,r.next)&&(_e(r),r=r.next),r}function Xt(n,t){if(!n)return n;t||(t=n);let e=n,i;do if(i=!1,!e.steiner&&(se(e,e.next)||N(e.prev,e,e.next)===0)){if(_e(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function xe(n,t,e,i,s,r,o){if(!n)return;!o&&r&&Vi(n,i,s,r);let l=n;for(;n.prev!==n.next;){const a=n.prev,u=n.next;if(r?Mi(n,i,s,r):Ci(n)){t.push(a.i,n.i,u.i),_e(n),n=u.next,l=u.next;continue}if(n=u,n===l){o?o===1?(n=Ni(Xt(n),t),xe(n,t,e,i,s,r,2)):o===2&&Oi(n,t,e,i,s,r):xe(Xt(n),t,e,i,s,r,1);break}}}function Ci(n){const t=n.prev,e=n,i=n.next;if(N(t,e,i)>=0)return!1;const s=t.x,r=e.x,o=i.x,l=t.y,a=e.y,u=i.y,f=Math.min(s,r,o),c=Math.min(l,a,u),h=Math.max(s,r,o),d=Math.max(l,a,u);let p=i.next;for(;p!==t;){if(p.x>=f&&p.x<=h&&p.y>=c&&p.y<=d&&pe(s,l,r,a,o,u,p.x,p.y)&&N(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Mi(n,t,e,i){const s=n.prev,r=n,o=n.next;if(N(s,r,o)>=0)return!1;const l=s.x,a=r.x,u=o.x,f=s.y,c=r.y,h=o.y,d=Math.min(l,a,u),p=Math.min(f,c,h),g=Math.max(l,a,u),_=Math.max(f,c,h),x=nn(d,p,t,e,i),E=nn(g,_,t,e,i);let m=n.prevZ,y=n.nextZ;for(;m&&m.z>=x&&y&&y.z<=E;){if(m.x>=d&&m.x<=g&&m.y>=p&&m.y<=_&&m!==s&&m!==o&&pe(l,f,a,c,u,h,m.x,m.y)&&N(m.prev,m,m.next)>=0||(m=m.prevZ,y.x>=d&&y.x<=g&&y.y>=p&&y.y<=_&&y!==s&&y!==o&&pe(l,f,a,c,u,h,y.x,y.y)&&N(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;m&&m.z>=x;){if(m.x>=d&&m.x<=g&&m.y>=p&&m.y<=_&&m!==s&&m!==o&&pe(l,f,a,c,u,h,m.x,m.y)&&N(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=E;){if(y.x>=d&&y.x<=g&&y.y>=p&&y.y<=_&&y!==s&&y!==o&&pe(l,f,a,c,u,h,y.x,y.y)&&N(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function Ni(n,t){let e=n;do{const i=e.prev,s=e.next.next;!se(i,s)&&oi(i,e,e.next,s)&&ve(i,s)&&ve(s,i)&&(t.push(i.i,e.i,s.i),_e(e),_e(e.next),e=n=s),e=e.next}while(e!==n);return Xt(e)}function Oi(n,t,e,i,s,r){let o=n;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&Gi(o,l)){let a=li(o,l);o=Xt(o,o.next),a=Xt(a,a.next),xe(o,t,e,i,s,r,0),xe(a,t,e,i,s,r,0);return}l=l.next}o=o.next}while(o!==n)}function Di(n,t,e,i){const s=[];for(let r=0,o=t.length;r<o;r++){const l=t[r]*i,a=r<o-1?t[r+1]*i:n.length,u=si(n,l,a,i,!1);u===u.next&&(u.steiner=!0),s.push($i(u))}s.sort(Fi);for(let r=0;r<s.length;r++)e=Bi(s[r],e);return e}function Fi(n,t){let e=n.x-t.x;if(e===0&&(e=n.y-t.y,e===0)){const i=(n.next.y-n.y)/(n.next.x-n.x),s=(t.next.y-t.y)/(t.next.x-t.x);e=i-s}return e}function Bi(n,t){const e=Ui(n,t);if(!e)return t;const i=li(e,n);return Xt(i,i.next),Xt(e,e.next)}function Ui(n,t){let e=t;const i=n.x,s=n.y;let r=-1/0,o;if(se(n,e))return e;do{if(se(n,e.next))return e.next;if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const c=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(c<=i&&c>r&&(r=c,o=e.x<e.next.x?e:e.next,c===i))return o}e=e.next}while(e!==t);if(!o)return null;const l=o,a=o.x,u=o.y;let f=1/0;e=o;do{if(i>=e.x&&e.x>=a&&i!==e.x&&ri(s<u?i:r,s,a,u,s<u?r:i,s,e.x,e.y)){const c=Math.abs(s-e.y)/(i-e.x);ve(e,n)&&(c<f||c===f&&(e.x>o.x||e.x===o.x&&ki(o,e)))&&(o=e,f=c)}e=e.next}while(e!==l);return o}function ki(n,t){return N(n.prev,n,t.prev)<0&&N(t.next,n,n.next)<0}function Vi(n,t,e,i){let s=n;do s.z===0&&(s.z=nn(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,zi(s)}function zi(n){let t,e=1;do{let i=n,s;n=null;let r=null;for(t=0;i;){t++;let o=i,l=0;for(let u=0;u<e&&(l++,o=o.nextZ,!!o);u++);let a=e;for(;l>0||a>0&&o;)l!==0&&(a===0||!o||i.z<=o.z)?(s=i,i=i.nextZ,l--):(s=o,o=o.nextZ,a--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;i=o}r.nextZ=null,e*=2}while(t>1);return n}function nn(n,t,e,i,s){return n=(n-e)*s|0,t=(t-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function $i(n){let t=n,e=n;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==n);return e}function ri(n,t,e,i,s,r,o,l){return(s-o)*(t-l)>=(n-o)*(r-l)&&(n-o)*(i-l)>=(e-o)*(t-l)&&(e-o)*(r-l)>=(s-o)*(i-l)}function pe(n,t,e,i,s,r,o,l){return!(n===o&&t===l)&&ri(n,t,e,i,s,r,o,l)}function Gi(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!Xi(n,t)&&(ve(n,t)&&ve(t,n)&&Zi(n,t)&&(N(n.prev,n,t.prev)||N(n,t.prev,t))||se(n,t)&&N(n.prev,n,n.next)>0&&N(t.prev,t,t.next)>0)}function N(n,t,e){return(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y)}function se(n,t){return n.x===t.x&&n.y===t.y}function oi(n,t,e,i){const s=Ae(N(n,t,e)),r=Ae(N(n,t,i)),o=Ae(N(e,i,n)),l=Ae(N(e,i,t));return!!(s!==r&&o!==l||s===0&&Pe(n,e,t)||r===0&&Pe(n,i,t)||o===0&&Pe(e,n,i)||l===0&&Pe(e,t,i))}function Pe(n,t,e){return t.x<=Math.max(n.x,e.x)&&t.x>=Math.min(n.x,e.x)&&t.y<=Math.max(n.y,e.y)&&t.y>=Math.min(n.y,e.y)}function Ae(n){return n>0?1:n<0?-1:0}function Xi(n,t){let e=n;do{if(e.i!==n.i&&e.next.i!==n.i&&e.i!==t.i&&e.next.i!==t.i&&oi(e,e.next,n,t))return!0;e=e.next}while(e!==n);return!1}function ve(n,t){return N(n.prev,n,n.next)<0?N(n,t,n.next)>=0&&N(n,n.prev,t)>=0:N(n,t,n.prev)<0||N(n,n.next,t)<0}function Zi(n,t){let e=n,i=!1;const s=(n.x+t.x)/2,r=(n.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&s<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==n);return i}function li(n,t){const e=sn(n.i,n.x,n.y),i=sn(t.i,t.x,t.y),s=n.next,r=t.prev;return n.next=t,t.prev=n,e.next=s,s.prev=e,i.next=e,e.prev=i,r.next=i,i.prev=r,i}function En(n,t,e,i){const s=sn(n,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function _e(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function sn(n,t,e){return{i:n,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function qi(n,t,e,i){let s=0;for(let r=t,o=e-i;r<e;r+=i)s+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return s}function Wi(n,t,e){const i=n.subtract(t),s=e.multiplyScalar(i.dot(e));return n.subtract(s.multiplyScalar(2))}function Tn(n,t,e,i){const s=[],r=[];if(n.length<3)return{clippedPolygon:[],clippedUVs:[]};const o=t.length>0;if(o&&t.length!==n.length)return console.error("Polygon and UV arrays must have the same length."),{clippedPolygon:[],clippedUVs:[]};for(let l=0;l<n.length;l++){const a=n[l],u=n[(l+n.length-1)%n.length],f=i.dot(a.subtract(e)),c=i.dot(u.subtract(e)),h=f>=0,d=c>=0;if(h&&d)s.push(a),o&&r.push(t[l]);else if(d&&!h){const p=a.subtract(u),g=i.dot(e.subtract(u))/i.dot(p),_=u.add(p.multiplyScalar(g));if(s.push(_),o){const x=t[l],E=t[(l+t.length-1)%t.length],m=E.add(x.subtract(E).multiplyScalar(g));r.push(m)}}else if(!(!h&&!d)){if(!d&&h){const p=a.subtract(u),g=i.dot(e.subtract(u))/i.dot(p),_=u.add(p.multiplyScalar(g));if(s.push(_),s.push(a),o){const x=t[l],E=t[(l+t.length-1)%t.length],m=E.add(x.subtract(E).multiplyScalar(g));r.push(m),r.push(x)}}}}return{clippedPolygon:s,clippedUVs:r}}function Hi(n,t,e,i){if(n.length<3)return{reflectedPolygon:[],reflectedUVs:[],otherPolygon:[],otherUVs:[]};const s=i,r=i.subtract(e);if(r.lengthSq()===0)return{reflectedPolygon:[],reflectedUVs:[],otherPolygon:n,otherUVs:t};const o=r.normalize().inverted(),{clippedPolygon:l,clippedUVs:a}=Tn(n,t,s,o),{clippedPolygon:u,clippedUVs:f}=Tn(n,t,s,o.inverted());return{reflectedPolygon:l.map(h=>Wi(h,s,o)),reflectedUVs:a,otherPolygon:u,otherUVs:f}}function Sn(n){if(n.length===0||n[0].length<3)return[];const t=[],e=[];let i=0;for(const o of n[0])t.push(o[0],o[1]);i+=n[0].length;for(let o=1;o<n.length;o++){e.push(i);const l=n[o];for(const a of l)t.push(a[0],a[1]);i+=l.length}const s=en(t,e,2),r=[];for(let o=0;o<s.length;o+=3){const l=s[o],a=s[o+1],u=s[o+2],f=[t[l*2],t[l*2+1]],c=[t[a*2],t[a*2+1]],h=[t[u*2],t[u*2+1]],d=[f,c,h];r.push([d])}return r}function wn(n){return!n||n.length===0?[]:Array.isArray(n[0][0][0])?n.flatMap(e=>Sn(e)):Sn(n)}function bn(n){let t=0;for(let e=0;e<n.length;e++){const[i,s]=n[e],[r,o]=n[(e+1)%n.length];t+=i*o-r*s}return t/2}function Rn(n){if(n.length===0)return 0;let t=Math.abs(bn(n[0]));for(let e=1;e<n.length;e++)t-=Math.abs(bn(n[e]));return t}function Pn(n){return n.length===0?0:Array.isArray(n[0][0][0])?n.reduce((t,e)=>t+Rn(e),0):Rn(n)}function An(n){return n.map(t=>[Math.round(t[0]),Math.round(t[1])])}function Yt(n){return n.length===0?[]:Array.isArray(n[0])&&Array.isArray(n[0][0])&&Array.isArray(n[0][0][0])?n.map(t=>t.map(e=>An(e))):n.map(t=>An(t))}function Yi(n,t,e=10){return ui(n,t)?ji(n,t)<=e:!1}function ui(n,t){if(t.length<3)return!1;let e=!1;const i=t.length;for(let s=0,r=i-1;s<i;r=s++){const o=t[s],l=t[r];o.y>n.y!=l.y>n.y&&n.x<(l.x-o.x)*(n.y-o.y)/(l.y-o.y)+o.x&&(e=!e)}return e}function ji(n,t){let e=1/0;const i=t.length;for(let s=0;s<i;s++){const r=t[s],o=t[(s+1)%i],l=Qi(n,r,o);e=Math.min(e,l)}return e}function Qi(n,t,e){const i=e.subtract(t),s=n.subtract(t),r=i.lengthSq();if(r===0)return n.distanceTo(t);let o=s.dot(i)/r;o=Math.max(0,Math.min(1,o));const l=t.add(i.multiplyScalar(o));return n.distanceTo(l)}const ce=n=>n.length<3?[]:[n.map(t=>[t.x,t.y])],Ln=n=>n.map(([t,e])=>new L(t,e)),In=`
    attribute vec2 a_position;
    attribute vec2 a_texCoord;
    
    uniform vec2 u_resolution;
    
    varying vec2 v_texCoord;
    
    void main() {
        vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;
        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
        v_texCoord = a_texCoord;
    }
`,Ji=`
    precision lowp float;
    
    uniform sampler2D u_sampler;
    uniform vec4 u_backFaceColor;
    uniform bool u_useTexture;
    
    varying vec2 v_texCoord;
    
    void main() {
        if (u_useTexture) {
            gl_FragColor = texture2D(u_sampler, v_texCoord);
        } else {
            gl_FragColor = u_backFaceColor;
        }
    }
`,Ki=`
    precision lowp float;
    uniform vec4 u_color;
    
    void main() {
        gl_FragColor = u_color;
    }
`;class ts{constructor(t){const e=t.getContext("webgl");if(!e)throw new Error("WebGL not supported");this.gl=e,e.enable(e.POLYGON_OFFSET_FILL),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.textureProgram=this.createProgram(In,Ji),this.textureLocations={position:e.getAttribLocation(this.textureProgram,"a_position"),texCoord:e.getAttribLocation(this.textureProgram,"a_texCoord"),resolution:e.getUniformLocation(this.textureProgram,"u_resolution"),sampler:e.getUniformLocation(this.textureProgram,"u_sampler"),backFaceColor:e.getUniformLocation(this.textureProgram,"u_backFaceColor"),useTexture:e.getUniformLocation(this.textureProgram,"u_useTexture")},this.solidColorProgram=this.createProgram(In,Ki),this.solidColorLocations={position:e.getAttribLocation(this.solidColorProgram,"a_position"),resolution:e.getUniformLocation(this.solidColorProgram,"u_resolution"),color:e.getUniformLocation(this.solidColorProgram,"u_color")},this.positionBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer()}resize(t,e){this.gl.viewport(0,0,t,e)}createTexture(t){const e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}drawSolidPolygon(t,e){if(t.length<3)return;const i=this.gl;i.useProgram(this.solidColorProgram);const s=t.flatMap(o=>[o.x,o.y]),r=en(s);i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(s),i.STATIC_DRAW),i.enableVertexAttribArray(this.solidColorLocations.position),i.vertexAttribPointer(this.solidColorLocations.position,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),i.STATIC_DRAW),i.uniform2f(this.solidColorLocations.resolution,i.canvas.width,i.canvas.height),i.uniform4f(this.solidColorLocations.color,e[0],e[1],e[2],e[3]),i.drawElements(i.TRIANGLES,r.length,i.UNSIGNED_SHORT,0)}startRender(){const t=this.gl;t.clearColor(.8,.9,1,1),t.clear(t.COLOR_BUFFER_BIT)}endRender(){}render(t,e,i){const s=this.gl;for(const r of e){if(r.points.length<3||!r.visible||t&&(r.isCollision||r.isNegativeCollision))continue;if(r.uv.length==0){this.drawSolidPolygon(r.points,r.debugColor??[0,0,0,.8]);continue}const o=r.points.flatMap(u=>[u.x,u.y]);s.useProgram(this.textureProgram);const l=en(o),a=r.uv.flatMap(u=>[u.x,u.y]);s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(o),s.STATIC_DRAW),s.enableVertexAttribArray(this.textureLocations.position),s.vertexAttribPointer(this.textureLocations.position,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(a),s.STATIC_DRAW),s.enableVertexAttribArray(this.textureLocations.texCoord),s.vertexAttribPointer(this.textureLocations.texCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),s.STATIC_DRAW),s.uniform2f(this.textureLocations.resolution,s.canvas.width,s.canvas.height),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,i),s.uniform1i(this.textureLocations.sampler,0),r.face?s.uniform1i(this.textureLocations.useTexture,1):(s.uniform1i(this.textureLocations.useTexture,0),s.uniform4f(this.textureLocations.backFaceColor,.85,.85,.85,1)),s.drawElements(s.TRIANGLES,l.length,s.UNSIGNED_SHORT,0),s.useProgram(this.solidColorProgram),s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer),s.enableVertexAttribArray(this.solidColorLocations.position),s.vertexAttribPointer(this.solidColorLocations.position,2,s.FLOAT,!1,0,0),s.uniform2f(this.solidColorLocations.resolution,s.canvas.width,s.canvas.height),s.uniform4f(this.solidColorLocations.color,0,0,0,1),s.drawArrays(s.LINE_LOOP,0,r.points.length)}}createShader(t,e){const i=this.gl,s=i.createShader(t);if(i.shaderSource(s,e),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))throw console.error("Error compiling shader:",i.getShaderInfoLog(s)),i.deleteShader(s),new Error("Failed to compile shader");return s}createProgram(t,e){const i=this.gl,s=this.createShader(i.VERTEX_SHADER,t),r=this.createShader(i.FRAGMENT_SHADER,e),o=i.createProgram();if(i.attachShader(o,s),i.attachShader(o,r),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw console.error("Error linking program:",i.getProgramInfoLog(o)),i.deleteProgram(o),new Error("Failed to link program");return o}createImageTexture(t){return new Promise((e,i)=>{const s=new Image;s.src=t,s.onload=()=>e(this.createTexture(s)),s.onerror=i})}}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function es(n,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(f){return a([u,f])}}function a(u){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(r=u[0]&2?s.return:u[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,u[1])).done)return r;switch(s=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,s=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){e.label=u[1];break}if(u[0]===6&&e.label<r[1]){e.label=r[1],r=u;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(u);break}r[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(n,e)}catch(f){u=[6,f],s=0}finally{i=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ut=function(){function n(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return n}();function ns(n,t){return n>t?1:n<t?-1:0}function Dt(n,t,e){for(var i=new Ut(null,null),s=i,r=i;;){var o=e(n,t.key);if(o<0){if(t.left===null)break;if(e(n,t.left.key)<0){var l=t.left;if(t.left=l.right,l.right=t,t=l,t.left===null)break}r.left=t,r=t,t=t.left}else if(o>0){if(t.right===null)break;if(e(n,t.right.key)>0){var l=t.right;if(t.right=l.left,l.left=t,t=l,t.right===null)break}s.right=t,s=t,t=t.right}else break}return s.right=t.left,r.left=t.right,t.left=i.right,t.right=i.left,t}function We(n,t,e,i){var s=new Ut(n,t);if(e===null)return s.left=s.right=null,s;e=Dt(n,e,i);var r=i(n,e.key);return r<0?(s.left=e.left,s.right=e,e.left=null):r>=0&&(s.right=e.right,s.left=e,e.right=null),s}function Cn(n,t,e){var i=null,s=null;if(t){t=Dt(n,t,e);var r=e(t.key,n);r===0?(i=t.left,s=t.right):r<0?(s=t.right,t.right=null,i=t):(i=t.left,t.left=null,s=t)}return{left:i,right:s}}function is(n,t,e){return t===null?n:(n===null||(t=Dt(n.key,t,e),t.left=n),t)}function rn(n,t,e,i,s){if(n){i(""+t+(e?"└── ":"├── ")+s(n)+`
`);var r=t+(e?"    ":"│   ");n.left&&rn(n.left,r,!1,i,s),n.right&&rn(n.right,r,!0,i,s)}}var pn=function(){function n(t){t===void 0&&(t=ns),this._root=null,this._size=0,this._comparator=t}return n.prototype.insert=function(t,e){return this._size++,this._root=We(t,e,this._root,this._comparator)},n.prototype.add=function(t,e){var i=new Ut(t,e);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var s=this._comparator,r=Dt(t,this._root,s),o=s(t,r.key);return o===0?this._root=r:(o<0?(i.left=r.left,i.right=r,r.left=null):o>0&&(i.right=r.right,i.left=r,r.right=null),this._size++,this._root=i),this._root},n.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},n.prototype._remove=function(t,e,i){var s;if(e===null)return null;e=Dt(t,e,i);var r=i(t,e.key);return r===0?(e.left===null?s=e.right:(s=Dt(t,e.left,i),s.right=e.right),this._size--,s):e},n.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Dt(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},n.prototype.findStatic=function(t){for(var e=this._root,i=this._comparator;e;){var s=i(t,e.key);if(s===0)return e;s<0?e=e.left:e=e.right}return null},n.prototype.find=function(t){return this._root&&(this._root=Dt(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},n.prototype.contains=function(t){for(var e=this._root,i=this._comparator;e;){var s=i(t,e.key);if(s===0)return!0;s<0?e=e.left:e=e.right}return!1},n.prototype.forEach=function(t,e){for(var i=this._root,s=[],r=!1;!r;)i!==null?(s.push(i),i=i.left):s.length!==0?(i=s.pop(),t.call(e,i),i=i.right):r=!0;return this},n.prototype.range=function(t,e,i,s){for(var r=[],o=this._comparator,l=this._root,a;r.length!==0||l;)if(l)r.push(l),l=l.left;else{if(l=r.pop(),a=o(l.key,e),a>0)break;if(o(l.key,t)>=0&&i.call(s,l))return this;l=l.right}return this},n.prototype.keys=function(){var t=[];return this.forEach(function(e){var i=e.key;return t.push(i)}),t},n.prototype.values=function(){var t=[];return this.forEach(function(e){var i=e.data;return t.push(i)}),t},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},n.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},n.prototype.at=function(t){for(var e=this._root,i=!1,s=0,r=[];!i;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),s===t)return e;s++,e=e.right}else i=!0;return null},n.prototype.next=function(t){var e=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var s=this._comparator;e;){var r=s(t.key,e.key);if(r===0)break;r<0?(i=e,e=e.left):e=e.right}return i},n.prototype.prev=function(t){var e=this._root,i=null;if(t.left!==null){for(i=t.left;i.right;)i=i.right;return i}for(var s=this._comparator;e;){var r=s(t.key,e.key);if(r===0)break;r<0?e=e.left:(i=e,e=e.right)}return i},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return rs(this._root)},n.prototype.load=function(t,e,i){e===void 0&&(e=[]),i===void 0&&(i=!1);var s=t.length,r=this._comparator;if(i&&un(t,e,0,s-1,r),this._root===null)this._root=on(t,e,0,s),this._size=s;else{var o=os(this.toList(),ss(t,e),r);s=this._size+s,this._root=ln({head:o},0,s)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){t===void 0&&(t=function(i){return String(i.key)});var e=[];return rn(this._root,"",!0,function(i){return e.push(i)},t),e.join("")},n.prototype.update=function(t,e,i){var s=this._comparator,r=Cn(t,this._root,s),o=r.left,l=r.right;s(t,e)<0?l=We(e,i,l,s):o=We(e,i,o,s),this._root=is(o,l,s)},n.prototype.split=function(t){return Cn(t,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var t,e,i;return es(this,function(s){switch(s.label){case 0:t=this._root,e=[],i=!1,s.label=1;case 1:return i?[3,6]:t===null?[3,2]:(e.push(t),t=t.left,[3,5]);case 2:return e.length===0?[3,4]:(t=e.pop(),[4,t]);case 3:return s.sent(),t=t.right,[3,5];case 4:i=!0,s.label=5;case 5:return[3,1];case 6:return[2]}})},n}();function on(n,t,e,i){var s=i-e;if(s>0){var r=e+Math.floor(s/2),o=n[r],l=t[r],a=new Ut(o,l);return a.left=on(n,t,e,r),a.right=on(n,t,r+1,i),a}return null}function ss(n,t){for(var e=new Ut(null,null),i=e,s=0;s<n.length;s++)i=i.next=new Ut(n[s],t[s]);return i.next=null,e.next}function rs(n){for(var t=n,e=[],i=!1,s=new Ut(null,null),r=s;!i;)t?(e.push(t),t=t.left):e.length>0?(t=r=r.next=e.pop(),t=t.right):i=!0;return r.next=null,s.next}function ln(n,t,e){var i=e-t;if(i>0){var s=t+Math.floor(i/2),r=ln(n,t,s),o=n.head;return o.left=r,n.head=n.head.next,o.right=ln(n,s+1,e),o}return null}function os(n,t,e){for(var i=new Ut(null,null),s=i,r=n,o=t;r!==null&&o!==null;)e(r.key,o.key)<0?(s.next=r,r=r.next):(s.next=o,o=o.next),s=s.next;return r!==null?s.next=r:o!==null&&(s.next=o),i.next}function un(n,t,e,i,s){if(!(e>=i)){for(var r=n[e+i>>1],o=e-1,l=i+1;;){do o++;while(s(n[o],r)<0);do l--;while(s(n[l],r)>0);if(o>=l)break;var a=n[o];n[o]=n[l],n[l]=a,a=t[o],t[o]=t[l],t[l]=a}un(n,t,e,l,s),un(n,t,l+1,i,s)}}const Ct=11102230246251565e-32,Y=134217729,ls=(3+8*Ct)*Ct;function He(n,t,e,i,s){let r,o,l,a,u=t[0],f=i[0],c=0,h=0;f>u==f>-u?(r=u,u=t[++c]):(r=f,f=i[++h]);let d=0;if(c<n&&h<e)for(f>u==f>-u?(o=u+r,l=r-(o-u),u=t[++c]):(o=f+r,l=r-(o-f),f=i[++h]),r=o,l!==0&&(s[d++]=l);c<n&&h<e;)f>u==f>-u?(o=r+u,a=o-r,l=r-(o-a)+(u-a),u=t[++c]):(o=r+f,a=o-r,l=r-(o-a)+(f-a),f=i[++h]),r=o,l!==0&&(s[d++]=l);for(;c<n;)o=r+u,a=o-r,l=r-(o-a)+(u-a),u=t[++c],r=o,l!==0&&(s[d++]=l);for(;h<e;)o=r+f,a=o-r,l=r-(o-a)+(f-a),f=i[++h],r=o,l!==0&&(s[d++]=l);return(r!==0||d===0)&&(s[d++]=r),d}function us(n,t){let e=t[0];for(let i=1;i<n;i++)e+=t[i];return e}function Se(n){return new Float64Array(n)}const as=(3+16*Ct)*Ct,cs=(2+12*Ct)*Ct,hs=(9+64*Ct)*Ct*Ct,jt=Se(4),Mn=Se(8),Nn=Se(12),On=Se(16),tt=Se(4);function fs(n,t,e,i,s,r,o){let l,a,u,f,c,h,d,p,g,_,x,E,m,y,w,R,M,P;const U=n-s,k=e-s,D=t-r,F=i-r;y=U*F,h=Y*U,d=h-(h-U),p=U-d,h=Y*F,g=h-(h-F),_=F-g,w=p*_-(y-d*g-p*g-d*_),R=D*k,h=Y*D,d=h-(h-D),p=D-d,h=Y*k,g=h-(h-k),_=k-g,M=p*_-(R-d*g-p*g-d*_),x=w-M,c=w-x,jt[0]=w-(x+c)+(c-M),E=y+x,c=E-y,m=y-(E-c)+(x-c),x=m-R,c=m-x,jt[1]=m-(x+c)+(c-R),P=E+x,c=P-E,jt[2]=E-(P-c)+(x-c),jt[3]=P;let q=us(4,jt),G=cs*o;if(q>=G||-q>=G||(c=n-U,l=n-(U+c)+(c-s),c=e-k,u=e-(k+c)+(c-s),c=t-D,a=t-(D+c)+(c-r),c=i-F,f=i-(F+c)+(c-r),l===0&&a===0&&u===0&&f===0)||(G=hs*o+ls*Math.abs(q),q+=U*f+F*l-(D*u+k*a),q>=G||-q>=G))return q;y=l*F,h=Y*l,d=h-(h-l),p=l-d,h=Y*F,g=h-(h-F),_=F-g,w=p*_-(y-d*g-p*g-d*_),R=a*k,h=Y*a,d=h-(h-a),p=a-d,h=Y*k,g=h-(h-k),_=k-g,M=p*_-(R-d*g-p*g-d*_),x=w-M,c=w-x,tt[0]=w-(x+c)+(c-M),E=y+x,c=E-y,m=y-(E-c)+(x-c),x=m-R,c=m-x,tt[1]=m-(x+c)+(c-R),P=E+x,c=P-E,tt[2]=E-(P-c)+(x-c),tt[3]=P;const V=He(4,jt,4,tt,Mn);y=U*f,h=Y*U,d=h-(h-U),p=U-d,h=Y*f,g=h-(h-f),_=f-g,w=p*_-(y-d*g-p*g-d*_),R=D*u,h=Y*D,d=h-(h-D),p=D-d,h=Y*u,g=h-(h-u),_=u-g,M=p*_-(R-d*g-p*g-d*_),x=w-M,c=w-x,tt[0]=w-(x+c)+(c-M),E=y+x,c=E-y,m=y-(E-c)+(x-c),x=m-R,c=m-x,tt[1]=m-(x+c)+(c-R),P=E+x,c=P-E,tt[2]=E-(P-c)+(x-c),tt[3]=P;const ut=He(V,Mn,4,tt,Nn);y=l*f,h=Y*l,d=h-(h-l),p=l-d,h=Y*f,g=h-(h-f),_=f-g,w=p*_-(y-d*g-p*g-d*_),R=a*u,h=Y*a,d=h-(h-a),p=a-d,h=Y*u,g=h-(h-u),_=u-g,M=p*_-(R-d*g-p*g-d*_),x=w-M,c=w-x,tt[0]=w-(x+c)+(c-M),E=y+x,c=E-y,m=y-(E-c)+(x-c),x=m-R,c=m-x,tt[1]=m-(x+c)+(c-R),P=E+x,c=P-E,tt[2]=E-(P-c)+(x-c),tt[3]=P;const Pt=He(ut,Nn,4,tt,On);return On[Pt-1]}function ds(n,t,e,i,s,r){const o=(t-r)*(e-s),l=(n-s)*(i-r),a=o-l,u=Math.abs(o+l);return Math.abs(a)>=as*u?a:-fs(n,t,e,i,s,r,u)}var ai={};const he=(n,t)=>n.ll.x<=t.x&&t.x<=n.ur.x&&n.ll.y<=t.y&&t.y<=n.ur.y,an=(n,t)=>{if(t.ur.x<n.ll.x||n.ur.x<t.ll.x||t.ur.y<n.ll.y||n.ur.y<t.ll.y)return null;const e=n.ll.x<t.ll.x?t.ll.x:n.ll.x,i=n.ur.x<t.ur.x?n.ur.x:t.ur.x,s=n.ll.y<t.ll.y?t.ll.y:n.ll.y,r=n.ur.y<t.ur.y?n.ur.y:t.ur.y;return{ll:{x:e,y:s},ur:{x:i,y:r}}};let Ft=Number.EPSILON;Ft===void 0&&(Ft=Math.pow(2,-52));const ps=Ft*Ft,Dn=(n,t)=>{if(-Ft<n&&n<Ft&&-Ft<t&&t<Ft)return 0;const e=n-t;return e*e<ps*n*t?0:n<t?-1:1};class gs{constructor(){this.reset()}reset(){this.xRounder=new Fn,this.yRounder=new Fn}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}class Fn{constructor(){this.tree=new pn,this.round(0)}round(t){const e=this.tree.add(t),i=this.tree.prev(e);if(i!==null&&Dn(e.key,i.key)===0)return this.tree.remove(t),i.key;const s=this.tree.next(e);return s!==null&&Dn(e.key,s.key)===0?(this.tree.remove(t),s.key):t}}const Ee=new gs,Oe=(n,t)=>n.x*t.y-n.y*t.x,ci=(n,t)=>n.x*t.x+n.y*t.y,Bn=(n,t,e)=>{const i=ds(n.x,n.y,t.x,t.y,e.x,e.y);return i>0?-1:i<0?1:0},Ue=n=>Math.sqrt(ci(n,n)),ms=(n,t,e)=>{const i={x:t.x-n.x,y:t.y-n.y},s={x:e.x-n.x,y:e.y-n.y};return Oe(s,i)/Ue(s)/Ue(i)},ys=(n,t,e)=>{const i={x:t.x-n.x,y:t.y-n.y},s={x:e.x-n.x,y:e.y-n.y};return ci(s,i)/Ue(s)/Ue(i)},Un=(n,t,e)=>t.y===0?null:{x:n.x+t.x/t.y*(e-n.y),y:e},kn=(n,t,e)=>t.x===0?null:{x:e,y:n.y+t.y/t.x*(e-n.x)},xs=(n,t,e,i)=>{if(t.x===0)return kn(e,i,n.x);if(i.x===0)return kn(n,t,e.x);if(t.y===0)return Un(e,i,n.y);if(i.y===0)return Un(n,t,e.y);const s=Oe(t,i);if(s==0)return null;const r={x:e.x-n.x,y:e.y-n.y},o=Oe(r,t)/s,l=Oe(r,i)/s,a=n.x+l*t.x,u=e.x+o*i.x,f=n.y+l*t.y,c=e.y+o*i.y,h=(a+u)/2,d=(f+c)/2;return{x:h,y:d}};class gt{static compare(t,e){const i=gt.comparePoints(t.point,e.point);return i!==0?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:Bt.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let i=0,s=e.length;i<s;i++){const r=e[i];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(i.segment.consumedBy===void 0)for(let s=e+1;s<t;s++){const r=this.point.events[s];r.consumedBy===void 0&&i.otherSE.point.events===r.otherSE.point.events&&i.segment.consume(r.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const s=this.point.events[e];s!==this&&!s.segment.ringOut&&s.segment.isInResult()&&t.push(s)}return t}getLeftmostComparator(t){const e=new Map,i=s=>{const r=s.otherSE;e.set(s,{sine:ms(this.point,t.point,r.point),cosine:ys(this.point,t.point,r.point)})};return(s,r)=>{e.has(s)||i(s),e.has(r)||i(r);const{sine:o,cosine:l}=e.get(s),{sine:a,cosine:u}=e.get(r);return o>=0&&a>=0?l<u?1:l>u?-1:0:o<0&&a<0?l<u?-1:l>u?1:0:a<o?-1:a>o?1:0}}}let vs=0;class Bt{static compare(t,e){const i=t.leftSE.point.x,s=e.leftSE.point.x,r=t.rightSE.point.x,o=e.rightSE.point.x;if(o<i)return 1;if(r<s)return-1;const l=t.leftSE.point.y,a=e.leftSE.point.y,u=t.rightSE.point.y,f=e.rightSE.point.y;if(i<s){if(a<l&&a<u)return 1;if(a>l&&a>u)return-1;const c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;const h=e.comparePoint(t.rightSE.point);return h!==0?h:-1}if(i>s){if(l<a&&l<f)return-1;if(l>a&&l>f)return 1;const c=e.comparePoint(t.leftSE.point);if(c!==0)return c;const h=t.comparePoint(e.rightSE.point);return h<0?1:h>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(r<o){const c=e.comparePoint(t.rightSE.point);if(c!==0)return c}if(r>o){const c=t.comparePoint(e.rightSE.point);if(c<0)return 1;if(c>0)return-1}if(r!==o){const c=u-l,h=r-i,d=f-a,p=o-s;if(c>h&&d<p)return 1;if(c<h&&d>p)return-1}return r>o?1:r<o||u<f?-1:u>f?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,i,s){this.id=++vs,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=s}static fromRing(t,e,i){let s,r,o;const l=gt.comparePoints(t,e);if(l<0)s=t,r=e,o=1;else if(l>0)s=e,r=t,o=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const a=new gt(s,!0),u=new gt(r,!1);return new Bt(a,u,[i],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,i=this.rightSE.point,s=this.vector();if(e.x===i.x)return t.x===e.x?0:t.x<e.x?1:-1;const r=(t.y-e.y)/s.y,o=e.x+r*s.x;if(t.x===o)return 0;const l=(t.x-e.x)/s.x,a=e.y+l*s.y;return t.y===a?0:t.y<a?-1:1}getIntersection(t){const e=this.bbox(),i=t.bbox(),s=an(e,i);if(s===null)return null;const r=this.leftSE.point,o=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,u=he(e,l)&&this.comparePoint(l)===0,f=he(i,r)&&t.comparePoint(r)===0,c=he(e,a)&&this.comparePoint(a)===0,h=he(i,o)&&t.comparePoint(o)===0;if(f&&u)return h&&!c?o:!h&&c?a:null;if(f)return c&&r.x===a.x&&r.y===a.y?null:r;if(u)return h&&o.x===l.x&&o.y===l.y?null:l;if(h&&c)return null;if(h)return o;if(c)return a;const d=xs(r,this.vector(),l,t.vector());return d===null||!he(s,d)?null:Ee.round(d.x,d.y)}split(t){const e=[],i=t.events!==void 0,s=new gt(t,!0),r=new gt(t,!1),o=this.rightSE;this.replaceRightSE(r),e.push(r),e.push(s);const l=new Bt(s,o,this.rings.slice(),this.windings.slice());return gt.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),gt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(s.checkForConsuming(),r.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,i=this.windings.length;e<i;e++)this.windings[e]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const s=Bt.compare(e,i);if(s!==0){if(s>0){const r=e;e=i,i=r}if(e.prev===i){const r=e;e=i,i=r}for(let r=0,o=i.rings.length;r<o;r++){const l=i.rings[r],a=i.windings[r],u=e.rings.indexOf(l);u===-1?(e.rings.push(l),e.windings.push(a)):e.windings[u]+=a}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,s=this._afterState.multiPolys;for(let l=0,a=this.rings.length;l<a;l++){const u=this.rings[l],f=this.windings[l],c=e.indexOf(u);c===-1?(e.push(u),i.push(f)):i[c]+=f}const r=[],o=[];for(let l=0,a=e.length;l<a;l++){if(i[l]===0)continue;const u=e[l],f=u.poly;if(o.indexOf(f)===-1)if(u.isExterior)r.push(f);else{o.indexOf(f)===-1&&o.push(f);const c=r.indexOf(u.poly);c!==-1&&r.splice(c,1)}}for(let l=0,a=r.length;l<a;l++){const u=r[l].multiPoly;s.indexOf(u)===-1&&s.push(u)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(vt.type){case"union":{const i=t.length===0,s=e.length===0;this._isInResult=i!==s;break}case"intersection":{let i,s;t.length<e.length?(i=t.length,s=e.length):(i=e.length,s=t.length),this._isInResult=s===vt.numMultiPolys&&i<s;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2===1;break}case"difference":{const i=s=>s.length===1&&s[0].isSubject;this._isInResult=i(t)!==i(e);break}default:throw new Error(`Unrecognized operation type found ${vt.type}`)}return this._isInResult}}class Vn{constructor(t,e,i){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=Ee.round(t[0][0],t[0][1]);this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let r=s;for(let o=1,l=t.length;o<l;o++){if(typeof t[o][0]!="number"||typeof t[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let a=Ee.round(t[o][0],t[o][1]);a.x===r.x&&a.y===r.y||(this.segments.push(Bt.fromRing(r,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),r=a)}(s.x!==r.x||s.y!==r.y)&&this.segments.push(Bt.fromRing(r,s,this))}getSweepEvents(){const t=[];for(let e=0,i=this.segments.length;e<i;e++){const s=this.segments[e];t.push(s.leftSE),t.push(s.rightSE)}return t}}class _s{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Vn(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,s=t.length;i<s;i++){const r=new Vn(t[i],this,!1);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,i=this.interiorRings.length;e<i;e++){const s=this.interiorRings[e].getSweepEvents();for(let r=0,o=s.length;r<o;r++)t.push(s[r])}return t}}class zn{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let i=0,s=t.length;i<s;i++){const r=new _s(t[i],this);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const s=this.polys[e].getSweepEvents();for(let r=0,o=s.length;r<o;r++)t.push(s[r])}return t}}class ke{static factory(t){const e=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];if(!r.isInResult()||r.ringOut)continue;let o=null,l=r.leftSE,a=r.rightSE;const u=[l],f=l.point,c=[];for(;o=l,l=a,u.push(l),l.point!==f;)for(;;){const h=l.getAvailableLinkedEvents();if(h.length===0){const g=u[0].point,_=u[u.length-1].point;throw new Error(`Unable to complete output ring starting at [${g.x}, ${g.y}]. Last matching segment found ends at [${_.x}, ${_.y}].`)}if(h.length===1){a=h[0].otherSE;break}let d=null;for(let g=0,_=c.length;g<_;g++)if(c[g].point===l.point){d=g;break}if(d!==null){const g=c.splice(d)[0],_=u.splice(g.index);_.unshift(_[0].otherSE),e.push(new ke(_.reverse()));continue}c.push({index:u.length,point:l.point});const p=l.getLeftmostComparator(o);a=h.sort(p)[0].otherSE;break}e.push(new ke(u))}return e}constructor(t){this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let u=1,f=this.events.length-1;u<f;u++){const c=this.events[u].point,h=this.events[u+1].point;Bn(c,t,h)!==0&&(e.push(c),t=c)}if(e.length===1)return null;const i=e[0],s=e[1];Bn(i,t,s)===0&&e.shift(),e.push(e[0]);const r=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,l=this.isExteriorRing()?e.length:-1,a=[];for(let u=o;u!=l;u+=r)a.push([e[u].x,e[u].y]);return a}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let s=1,r=this.events.length;s<r;s++){const o=this.events[s];gt.compare(t,o)>0&&(t=o)}let e=t.segment.prevInResult(),i=e?e.prevInResult():null;for(;;){if(!e)return null;if(!i)return e.ringOut;if(i.ringOut!==e.ringOut)return i.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=i.prevInResult(),i=e?e.prevInResult():null}}}class $n{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let e=0,i=this.interiorRings.length;e<i;e++){const s=this.interiorRings[e].getGeom();s!==null&&t.push(s)}return t}}class Es{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const s=this.polys[e].getGeom();s!==null&&t.push(s)}return t}_composePolys(t){const e=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];if(!r.poly)if(r.isExteriorRing())e.push(new $n(r));else{const o=r.enclosingRing();o.poly||e.push(new $n(o)),o.poly.addInterior(r)}}return e}}class Ts{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bt.compare;this.queue=t,this.tree=new pn(e),this.segments=[]}process(t){const e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),i;const s=t.isLeft?this.tree.add(e):this.tree.find(e);if(!s)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let r=s,o=s,l,a;for(;l===void 0;)r=this.tree.prev(r),r===null?l=null:r.key.consumedBy===void 0&&(l=r.key);for(;a===void 0;)o=this.tree.next(o),o===null?a=null:o.key.consumedBy===void 0&&(a=o.key);if(t.isLeft){let u=null;if(l){const c=l.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(u=c),!l.isAnEndpoint(c))){const h=this._splitSafely(l,c);for(let d=0,p=h.length;d<p;d++)i.push(h[d])}}let f=null;if(a){const c=a.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(f=c),!a.isAnEndpoint(c))){const h=this._splitSafely(a,c);for(let d=0,p=h.length;d<p;d++)i.push(h[d])}}if(u!==null||f!==null){let c=null;u===null?c=f:f===null?c=u:c=gt.comparePoints(u,f)<=0?u:f,this.queue.remove(e.rightSE),i.push(e.rightSE);const h=e.split(c);for(let d=0,p=h.length;d<p;d++)i.push(h[d])}i.length>0?(this.tree.remove(e),i.push(t)):(this.segments.push(e),e.prev=l)}else{if(l&&a){const u=l.getIntersection(a);if(u!==null){if(!l.isAnEndpoint(u)){const f=this._splitSafely(l,u);for(let c=0,h=f.length;c<h;c++)i.push(f[c])}if(!a.isAnEndpoint(u)){const f=this._splitSafely(a,u);for(let c=0,h=f.length;c<h;c++)i.push(f[c])}}}this.tree.remove(e)}return i}_splitSafely(t,e){this.tree.remove(t);const i=t.rightSE;this.queue.remove(i);const s=t.split(e);return s.push(i),t.consumedBy===void 0&&this.tree.add(t),s}}const Gn=typeof process<"u"&&ai.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ss=typeof process<"u"&&ai.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class ws{run(t,e,i){vt.type=t,Ee.reset();const s=[new zn(e,!0)];for(let c=0,h=i.length;c<h;c++)s.push(new zn(i[c],!1));if(vt.numMultiPolys=s.length,vt.type==="difference"){const c=s[0];let h=1;for(;h<s.length;)an(s[h].bbox,c.bbox)!==null?h++:s.splice(h,1)}if(vt.type==="intersection")for(let c=0,h=s.length;c<h;c++){const d=s[c];for(let p=c+1,g=s.length;p<g;p++)if(an(d.bbox,s[p].bbox)===null)return[]}const r=new pn(gt.compare);for(let c=0,h=s.length;c<h;c++){const d=s[c].getSweepEvents();for(let p=0,g=d.length;p<g;p++)if(r.insert(d[p]),r.size>Gn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new Ts(r);let l=r.size,a=r.pop();for(;a;){const c=a.key;if(r.size===l){const d=c.segment;throw new Error(`Unable to pop() ${c.isLeft?"left":"right"} SweepEvent [${c.point.x}, ${c.point.y}] from segment #${d.id} [${d.leftSE.point.x}, ${d.leftSE.point.y}] -> [${d.rightSE.point.x}, ${d.rightSE.point.y}] from queue.`)}if(r.size>Gn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>Ss)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const h=o.process(c);for(let d=0,p=h.length;d<p;d++){const g=h[d];g.consumedBy===void 0&&r.insert(g)}l=r.size,a=r.pop()}Ee.reset();const u=ke.factory(o.segments);return new Es(u).getGeom()}}const vt=new ws,bs=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return vt.run("union",n,e)},Rs=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return vt.run("intersection",n,e)},Ps=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return vt.run("xor",n,e)},As=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return vt.run("difference",n,e)};var ge={union:bs,intersection:Rs,xor:Ps,difference:As};const wt=(n,t=50)=>n.map(e=>new L(e[0]*t,e[1]*t)),Le=()=>[new L(0,0),new L(1,0),new L(1,1),new L(0,1)].map(n=>n.clone()),Ls=async n=>{const t=n.renderer;return[{paper:{points:wt([[1,1],[11,1],[11,11],[1,11]]),uvs:Le()},positiveShapes:[wt([[6,6],[11,6],[11,11],[6,11]])],texture1:await t.createImageTexture("./1-i.png"),texture2:await t.createImageTexture("./1-o.png")},{paper:{points:wt([[1,1],[11,1],[11,11],[1,11]]),uvs:Le()},positiveShapes:[wt([[1,1],[2.5,1],[2.5,11],[1,11]]),wt([[2.5,7],[11,7],[11,11],[2.5,11]]),wt([[2.5,6],[6,6],[6,7],[2.5,7]])],texture1:await t.createImageTexture("./2-i.png"),texture2:await t.createImageTexture("./2-o.png")},{paper:{points:wt([[1,1],[11,1],[11,11],[1,11]]),uvs:Le()},positiveShapes:[wt([[4.75,11],[9,11],[11,7.25],[11,3],[7.25,1],[3,1],[1,4.75],[1,9]])],texture1:await t.createImageTexture("./3-i.png"),texture2:await t.createImageTexture("./3-o.png")},{paper:{points:wt([[1,1],[11,1],[11,11],[1,11]]),uvs:Le()},positiveShapes:[wt([[3.5,1],[6,1],[6,3.5],[6-2.5,6],[1,6],[1,3.5]])],texture1:await t.createImageTexture("./4-i.png"),texture2:await t.createImageTexture("./4-o.png")}]};/**
 * anime.js - ESM
 * @version v4.1.4
 * @author Julian Garnier
 * @license MIT
 * @copyright (c) 2025 Julian Garnier
 * @see https://animejs.com
 */const kt=typeof window<"u",Ye=kt?window:null,Te=kt?document:null,B={OBJECT:0,ATTRIBUTE:1,CSS:2,TRANSFORM:3,CSS_VAR:4},b={NUMBER:0,UNIT:1,COLOR:2,COMPLEX:3},yt={NONE:0,AUTO:1,FORCE:2},lt={replace:0,none:1,blend:2},Xn=Symbol(),gn=Symbol(),hi=Symbol(),$e=Symbol(),Is=Symbol(),I=1e-11,cn=1e12,re=1e3,hn=120,Gt="",fi=(()=>{const n=new Map;return n.set("x","translateX"),n.set("y","translateY"),n.set("z","translateZ"),n})(),di=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],pi=di.reduce((n,t)=>({...n,[t]:t+"("}),{}),mt=()=>{},Cs=/(^#([\da-f]{3}){1,2}$)|(^#([\da-f]{4}){1,2}$)/i,Ms=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i,Ns=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(-?\d+|-?\d*.\d+)\s*\)/i,Os=/hsl\(\s*(-?\d+|-?\d*.\d+)\s*,\s*(-?\d+|-?\d*.\d+)%\s*,\s*(-?\d+|-?\d*.\d+)%\s*\)/i,Ds=/hsla\(\s*(-?\d+|-?\d*.\d+)\s*,\s*(-?\d+|-?\d*.\d+)%\s*,\s*(-?\d+|-?\d*.\d+)%\s*,\s*(-?\d+|-?\d*.\d+)\s*\)/i,Zn=/[-+]?\d*\.?\d+(?:e[-+]?\d)?/gi,Fs=/^([-+]?\d*\.?\d+(?:e[-+]?\d+)?)([a-z]+|%)$/i,Bs=/([a-z])([A-Z])/g,Us=/(\w+)(\([^)]+\)+)/g,gi={id:null,keyframes:null,playbackEase:null,playbackRate:1,frameRate:hn,loop:0,reversed:!1,alternate:!1,autoplay:!0,duration:re,delay:0,loopDelay:0,ease:"out(2)",composition:lt.replace,modifier:n=>n,onBegin:mt,onBeforeUpdate:mt,onUpdate:mt,onLoop:mt,onPause:mt,onComplete:mt,onRender:mt},ks={current:null,root:Te},Z={defaults:gi,precision:4,timeScale:1,tickThreshold:200},mi={version:"4.1.4",engine:null};kt&&(Ye.AnimeJS||(Ye.AnimeJS=[]),Ye.AnimeJS.push(mi));const Vs=n=>n.replace(Bs,"$1-$2").toLowerCase(),ne=(n,t)=>n.indexOf(t)===0,oe=Date.now,le=Array.isArray,je=n=>n&&n.constructor===Object,zs=n=>typeof n=="number"&&!isNaN(n),Ge=n=>typeof n=="string",Ve=n=>typeof n=="function",C=n=>typeof n>"u",Qe=n=>C(n)||n===null,yi=n=>kt&&n instanceof SVGElement,xi=n=>Cs.test(n),vi=n=>ne(n,"rgb"),_i=n=>ne(n,"hsl"),$s=n=>xi(n)||vi(n)||_i(n),De=n=>!Z.defaults.hasOwnProperty(n),Ie=n=>Ge(n)?parseFloat(n):n,Jt=Math.pow,Gs=Math.sqrt,Xs=Math.sin,Zs=Math.cos,qs=Math.abs,Ws=Math.ceil,Ei=Math.floor,Hs=Math.asin,mn=Math.PI,qn=Math.round,Q=(n,t,e)=>n<t?t:n>e?e:n,Wn={},O=(n,t)=>{if(t<0)return n;if(!t)return qn(n);let e=Wn[t];return e||(e=Wn[t]=10**t),qn(n*e)/e},$t=(n,t,e)=>n+(t-n)*e,yn=n=>n===1/0?cn:n===-1/0?-cn:n,ye=n=>n<=I?I:yn(O(n,11)),et=n=>le(n)?[...n]:n,Ys=(n,t)=>{const e={...n};for(let i in t){const s=n[i];e[i]=C(s)?t[i]:s}return e},$=(n,t,e,i="_prev",s="_next")=>{let r=n._head,o=s;for(e&&(r=n._tail,o=i);r;){const l=r[o];t(r),r=l}},me=(n,t,e="_prev",i="_next")=>{const s=t[e],r=t[i];s?s[i]=r:n._head=r,r?r[e]=s:n._tail=s,t[e]=null,t[i]=null},te=(n,t,e,i="_prev",s="_next")=>{let r=n._tail;for(;r&&e&&e(r,t);)r=r[i];const o=r?r[s]:n._head;r?r[s]=t:n._head=t,o?o[i]=t:n._tail=t,t[i]=r,t[s]=o};class Ti{constructor(t=0){this.deltaTime=0,this._currentTime=t,this._elapsedTime=t,this._startTime=t,this._lastTime=t,this._scheduledTime=0,this._frameDuration=O(re/hn,0),this._fps=hn,this._speed=1,this._hasChildren=!1,this._head=null,this._tail=null}get fps(){return this._fps}set fps(t){const e=this._frameDuration,i=+t,s=i<I?I:i,r=O(re/s,0);this._fps=s,this._frameDuration=r,this._scheduledTime+=r-e}get speed(){return this._speed}set speed(t){const e=+t;this._speed=e<I?I:e}requestTick(t){const e=this._scheduledTime,i=this._elapsedTime;if(this._elapsedTime+=t-i,i<e)return yt.NONE;const s=this._frameDuration,r=i-e;return this._scheduledTime+=r<s?s:r,yt.AUTO}computeDeltaTime(t){const e=t-this._lastTime;return this.deltaTime=e,this._lastTime=t,e}}const Fe=(n,t,e,i,s)=>{const r=n.parent,o=n.duration,l=n.completed,a=n.iterationDuration,u=n.iterationCount,f=n._currentIteration,c=n._loopDelay,h=n._reversed,d=n._alternate,p=n._hasChildren,g=n._delay,_=n._currentTime,x=g+a,E=t-g,m=Q(_,-g,o),y=Q(E,-g,o),w=E-_,R=y>0,M=y>=o,P=o<=I,U=s===yt.FORCE;let k=0,D=E,F=0;if(u>1){const Pt=~~(y/(a+(M?0:c)));n._currentIteration=Q(Pt,0,u),M&&n._currentIteration--,k=n._currentIteration%2,D=y%(a+c)||0}const q=h^(d&&k),G=n._ease;let V=M?q?0:o:q?a-D:D;G&&(V=a*G(V/a)||0);const ut=(r?r.backwards:E<_)?!q:!!q;if(n._currentTime=E,n._iterationTime=V,n.backwards=ut,R&&!n.began?(n.began=!0,!e&&!(r&&(ut||!r.began))&&n.onBegin(n)):E<=0&&(n.began=!1),!e&&!p&&R&&n._currentIteration!==f&&n.onLoop(n),U||s===yt.AUTO&&(t>=g&&t<=x||t<=g&&m>g||t>=x&&m!==o)||V>=x&&m!==o||V<=g&&m>0||t<=m&&m===o&&l||M&&!l&&P){if(R&&(n.computeDeltaTime(m),e||n.onBeforeUpdate(n)),!p){const Pt=U||(ut?w*-1:w)>=Z.tickThreshold,J=n._offset+(r?r._offset:0)+g+V;let v=n._head,W,at,Zt,Vt,ht=0;for(;v;){const it=v._composition,ft=v._currentTime,ct=v._changeDuration,ae=v._absoluteStartTime+v._changeDuration,_t=v._nextRep,dt=v._prevRep,At=it!==lt.none;if((Pt||(ft!==ct||J<=ae+(_t?_t._delay:0))&&(ft!==0||J>=v._absoluteStartTime))&&(!At||!v._isOverridden&&(!v._isOverlapped||J<=ae)&&(!_t||_t._isOverridden||J<=_t._absoluteStartTime)&&(!dt||dt._isOverridden||J>=dt._absoluteStartTime+dt._changeDuration+v._delay))){const Lt=v._currentTime=Q(V-v._startTime,0,ct),X=v._ease(Lt/v._updateDuration),st=v._modifier,xt=v._valueType,K=v._tweenType,rt=K===B.OBJECT,qt=xt===b.NUMBER,Et=qt&&rt||X===0||X===1?-1:Z.precision;let ot,Wt;if(qt)ot=Wt=st(O($t(v._fromNumber,v._toNumber,X),Et));else if(xt===b.UNIT)Wt=st(O($t(v._fromNumber,v._toNumber,X),Et)),ot=`${Wt}${v._unit}`;else if(xt===b.COLOR){const z=v._fromNumbers,Tt=v._toNumbers,St=O(Q(st($t(z[0],Tt[0],X)),0,255),0),It=O(Q(st($t(z[1],Tt[1],X)),0,255),0),we=O(Q(st($t(z[2],Tt[2],X)),0,255),0),Ht=Q(st(O($t(z[3],Tt[3],X),Et)),0,1);if(ot=`rgba(${St},${It},${we},${Ht})`,At){const zt=v._numbers;zt[0]=St,zt[1]=It,zt[2]=we,zt[3]=Ht}}else if(xt===b.COMPLEX){ot=v._strings[0];for(let z=0,Tt=v._toNumbers.length;z<Tt;z++){const St=st(O($t(v._fromNumbers[z],v._toNumbers[z],X),Et)),It=v._strings[z+1];ot+=`${It?St+It:St}`,At&&(v._numbers[z]=St)}}if(At&&(v._number=Wt),!i&&it!==lt.blend){const z=v.property;W=v.target,rt?W[z]=ot:K===B.ATTRIBUTE?W.setAttribute(z,ot):(at=W.style,K===B.TRANSFORM?(W!==Zt&&(Zt=W,Vt=W[$e]),Vt[z]=ot,ht=1):K===B.CSS?at[z]=ot:K===B.CSS_VAR&&at.setProperty(z,ot)),R&&(F=1)}else v._value=ot}if(ht&&v._renderTransforms){let Lt=Gt;for(let X in Vt)Lt+=`${pi[X]}${Vt[X]}) `;at.transform=Lt,ht=0}v=v._next}!e&&F&&n.onRender(n)}!e&&R&&n.onUpdate(n)}return r&&P?!e&&(r.began&&!ut&&E>=o&&!l||ut&&E<=I&&l)&&(n.onComplete(n),n.completed=!ut):R&&M?u===1/0?n._startTime+=n.duration:n._currentIteration>=u-1&&(n.paused=!0,!l&&!p&&(n.completed=!0,!e&&!(r&&(ut||!r.began))&&(n.onComplete(n),n._resolve(n)))):n.completed=!1,F},Kt=(n,t,e,i,s)=>{const r=n._currentIteration;if(Fe(n,t,e,i,s),n._hasChildren){const o=n,l=o.backwards,a=i?t:o._iterationTime,u=oe();let f=0,c=!0;if(!i&&o._currentIteration!==r){const h=o.iterationDuration;$(o,d=>{if(!l)!d.completed&&!d.backwards&&d._currentTime<d.iterationDuration&&Fe(d,h,e,1,yt.FORCE),d.began=!1,d.completed=!1;else{const p=d.duration,g=d._offset+d._delay,_=g+p;!e&&p<=I&&(!g||_===h)&&d.onComplete(d)}}),e||o.onLoop(o)}$(o,h=>{const d=O((a-h._offset)*h._speed,12),p=h._fps<o._fps?h.requestTick(u):s;f+=Fe(h,d,e,i,p),!h.completed&&c&&(c=!1)},l),!e&&f&&o.onRender(o),(c||l)&&o._currentTime>=o.duration&&(o.paused=!0,o.completed||(o.completed=!0,e||(o.onComplete(o),o._resolve(o))))}},ie={animation:null,update:mt},js=n=>{let t=ie.animation;return t||(t={duration:I,computeDeltaTime:mt,_offset:0,_delay:0,_head:null,_tail:null},ie.animation=t,ie.update=()=>{n.forEach(e=>{for(let i in e){const s=e[i],r=s._head;if(r){const o=r._valueType,l=o===b.COMPLEX||o===b.COLOR?et(r._fromNumbers):null;let a=r._fromNumber,u=s._tail;for(;u&&u!==r;){if(l)for(let f=0,c=u._numbers.length;f<c;f++)l[f]+=u._numbers[f];else a+=u._number;u=u._prevAdd}r._toNumber=a,r._toNumbers=l}}}),Fe(t,1,1,0,yt.FORCE)}),t},Si=kt?requestAnimationFrame:setImmediate,Qs=kt?cancelAnimationFrame:clearImmediate;class Js extends Ti{constructor(t){super(t),this.useDefaultMainLoop=!0,this.pauseOnDocumentHidden=!0,this.defaults=gi,this.paused=!0,this.reqId=0}update(){const t=this._currentTime=oe();if(this.requestTick(t)){this.computeDeltaTime(t);const e=this._speed,i=this._fps;let s=this._head;for(;s;){const r=s._next;s.paused?(me(this,s),this._hasChildren=!!this._tail,s._running=!1,s.completed&&!s._cancelled&&s.cancel()):Kt(s,(t-s._startTime)*s._speed*e,0,0,s._fps<i?s.requestTick(t):yt.AUTO),s=r}ie.update()}}wake(){return this.useDefaultMainLoop&&!this.reqId&&(this.requestTick(oe()),this.reqId=Si(wi)),this}pause(){if(this.reqId)return this.paused=!0,Ks()}resume(){if(this.paused)return this.paused=!1,$(this,t=>t.resetTime()),this.wake()}get speed(){return this._speed*(Z.timeScale===1?1:re)}set speed(t){this._speed=t*Z.timeScale,$(this,e=>e.speed=e._speed)}get timeUnit(){return Z.timeScale===1?"ms":"s"}set timeUnit(t){const i=t==="s",s=i?.001:1;if(Z.timeScale!==s){Z.timeScale=s,Z.tickThreshold=200*s;const r=i?.001:re;this.defaults.duration*=r,this._speed*=r}}get precision(){return Z.precision}set precision(t){Z.precision=t}}const j=(()=>{const n=new Js(oe());return kt&&(mi.engine=n,Te.addEventListener("visibilitychange",()=>{n.pauseOnDocumentHidden&&(Te.hidden?n.pause():n.resume())})),n})(),wi=()=>{j._head?(j.reqId=Si(wi),j.update()):j.reqId=0},Ks=()=>(Qs(j.reqId),j.reqId=0,j),tr=(n,t,e)=>{const i=n.style.transform;let s;if(i){const r=n[$e];let o;for(;o=Us.exec(i);){const l=o[1],a=o[2].slice(1,-1);r[l]=a,l===t&&(s=a,e&&(e[t]=a))}}return i&&!C(s)?s:ne(t,"scale")?"1":ne(t,"rotate")||ne(t,"skew")?"0deg":"0px"};function Hn(n){const t=Ge(n)?ks.root.querySelectorAll(n):n;if(t instanceof NodeList||t instanceof HTMLCollection)return t}function er(n){if(Qe(n))return[];if(!kt)return le(n)&&n.flat(1/0)||[n];if(le(n)){const e=n.flat(1/0),i=[];for(let s=0,r=e.length;s<r;s++){const o=e[s];if(!Qe(o)){const l=Hn(o);if(l)for(let a=0,u=l.length;a<u;a++){const f=l[a];if(!Qe(f)){let c=!1;for(let h=0,d=i.length;h<d;h++)if(i[h]===f){c=!0;break}c||i.push(f)}}else{let a=!1;for(let u=0,f=i.length;u<f;u++)if(i[u]===o){a=!0;break}a||i.push(o)}}}return i}const t=Hn(n);return t?Array.from(t):[n]}function nr(n){const t=er(n),e=t.length;if(e)for(let i=0;i<e;i++){const s=t[i];if(!s[Xn]){s[Xn]=!0;const r=yi(s);(s.nodeType||r)&&(s[gn]=!0,s[hi]=r,s[$e]={})}}return t}const ir=["opacity","rotate","overflow","color"],sr=(n,t)=>{if(ir.includes(t))return!1;if(n.getAttribute(t)||t in n){if(t==="scale"){const e=n.parentNode;return e&&e.tagName==="filter"}return!0}},rr=n=>{const t=Ms.exec(n)||Ns.exec(n),e=C(t[4])?1:+t[4];return[+t[1],+t[2],+t[3],e]},or=n=>{const t=n.length,e=t===4||t===5;return[+("0x"+n[1]+n[e?1:2]),+("0x"+n[e?2:3]+n[e?2:4]),+("0x"+n[e?3:5]+n[e?3:6]),t===5||t===9?+(+("0x"+n[e?4:7]+n[e?4:8])/255).toFixed(3):1]},Je=(n,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*(2/3-e)*6:n),lr=n=>{const t=Os.exec(n)||Ds.exec(n),e=+t[1]/360,i=+t[2]/100,s=+t[3]/100,r=C(t[4])?1:+t[4];let o,l,a;if(i===0)o=l=a=s;else{const u=s<.5?s*(1+i):s+i-s*i,f=2*s-u;o=O(Je(f,u,e+1/3)*255,0),l=O(Je(f,u,e)*255,0),a=O(Je(f,u,e-1/3)*255,0)}return[o,l,a,r]},ur=n=>vi(n)?rr(n):xi(n)?or(n):_i(n)?lr(n):[0,0,0,1],nt=(n,t)=>C(n)?t:n,Mt=(n,t,e,i,s)=>{if(Ve(n)){const r=()=>{const o=n(t,e,i);return isNaN(+o)?o||0:+o};return s&&(s.func=r),r()}else return n},bi=(n,t)=>n[gn]?n[hi]&&sr(n,t)?B.ATTRIBUTE:di.includes(t)||fi.get(t)?B.TRANSFORM:ne(t,"--")?B.CSS_VAR:t in n.style?B.CSS:t in n?B.OBJECT:B.ATTRIBUTE:B.OBJECT,Yn=(n,t,e)=>{const i=n.style[t];i&&e&&(e[t]=i);const s=i||getComputedStyle(n[Is]||n).getPropertyValue(t);return s==="auto"?"0":s},fe=(n,t,e,i)=>{const s=C(e)?bi(n,t):e;return s===B.OBJECT?n[t]||0:s===B.ATTRIBUTE?n.getAttribute(t):s===B.TRANSFORM?tr(n,t,i):s===B.CSS_VAR?Yn(n,t,i).trimStart():Yn(n,t,i)},Ke=(n,t,e)=>e==="-"?n-t:e==="+"?n+t:n*t,xn=()=>({t:b.NUMBER,n:0,u:null,o:null,d:null,s:null}),bt=(n,t)=>{if(t.t=b.NUMBER,t.n=0,t.u=null,t.o=null,t.d=null,t.s=null,!n)return t;const e=+n;if(isNaN(e)){let i=n;i[1]==="="&&(t.o=i[0],i=i.slice(2));const s=i.includes(" ")?!1:Fs.exec(i);if(s)return t.t=b.UNIT,t.n=+s[1],t.u=s[2],t;if(t.o)return t.n=+i,t;if($s(i))return t.t=b.COLOR,t.d=ur(i),t;{const r=i.match(Zn);return t.t=b.COMPLEX,t.d=r?r.map(Number):[],t.s=i.split(Zn)||[],t}}else return t.n=e,t},jn=(n,t)=>(t.t=n._valueType,t.n=n._toNumber,t.u=n._unit,t.o=null,t.d=et(n._toNumbers),t.s=et(n._strings),t),Nt=xn(),ze={_rep:new WeakMap,_add:new Map},vn=(n,t,e="_rep")=>{const i=ze[e];let s=i.get(n);return s||(s={},i.set(n,s)),s[t]?s[t]:s[t]={_head:null,_tail:null}},ar=(n,t)=>n._isOverridden||n._absoluteStartTime>t._absoluteStartTime,Be=n=>{n._isOverlapped=1,n._isOverridden=1,n._changeDuration=I,n._currentTime=I},Ri=(n,t)=>{const e=n._composition;if(e===lt.replace){const i=n._absoluteStartTime;te(t,n,ar,"_prevRep","_nextRep");const s=n._prevRep;if(s){const r=s.parent,o=s._absoluteStartTime+s._changeDuration;if(n.parent.id!==r.id&&r.iterationCount>1&&o+(r.duration-r.iterationDuration)>i){Be(s);let u=s._prevRep;for(;u&&u.parent.id===r.id;)Be(u),u=u._prevRep}const l=i-n._delay;if(o>l){const u=s._startTime,f=o-(u+s._updateDuration),c=O(l-f-u,12);s._changeDuration=c,s._currentTime=c,s._isOverlapped=1,c<I&&Be(s)}let a=!0;if($(r,u=>{u._isOverlapped||(a=!1)}),a){const u=r.parent;if(u){let f=!0;$(u,c=>{c!==r&&$(c,h=>{h._isOverlapped||(f=!1)})}),f&&u.cancel()}else r.cancel()}}}else if(e===lt.blend){const i=vn(n.target,n.property,"_add"),s=js(ze._add);let r=i._head;r||(r={...n},r._composition=lt.replace,r._updateDuration=I,r._startTime=0,r._numbers=et(n._fromNumbers),r._number=0,r._next=null,r._prev=null,te(i,r),te(s,r));const o=n._toNumber;if(n._fromNumber=r._fromNumber-o,n._toNumber=0,n._numbers=et(n._fromNumbers),n._number=0,r._fromNumber=o,n._toNumbers){const l=et(n._toNumbers);l&&l.forEach((a,u)=>{n._fromNumbers[u]=r._fromNumbers[u]-a,n._toNumbers[u]=0}),r._fromNumbers=l}te(i,n,null,"_prevAdd","_nextAdd")}return n},cr=n=>{const t=n._composition;if(t!==lt.none){const e=n.target,i=n.property,o=ze._rep.get(e)[i];if(me(o,n,"_prevRep","_nextRep"),t===lt.blend){const l=ze._add,a=l.get(e);if(!a)return;const u=a[i],f=ie.animation;me(u,n,"_prevAdd","_nextAdd");const c=u._head;if(c&&c===u._tail){me(u,c,"_prevAdd","_nextAdd"),me(f,c);let h=!0;for(let d in a)if(a[d]._head){h=!1;break}h&&l.delete(e)}}}return n},Qn=n=>(n.paused=!0,n.began=!1,n.completed=!1,n),fn=n=>(n._cancelled&&(n._hasChildren?$(n,fn):$(n,t=>{t._composition!==lt.none&&Ri(t,vn(t.target,t.property))}),n._cancelled=0),n);let hr=0;class fr extends Ti{constructor(t={},e=null,i=0){super(0);const{id:s,delay:r,duration:o,reversed:l,alternate:a,loop:u,loopDelay:f,autoplay:c,frameRate:h,playbackRate:d,onComplete:p,onLoop:g,onPause:_,onBegin:x,onBeforeUpdate:E,onUpdate:m}=t,y=e?0:j._elapsedTime,w=e?e.defaults:Z.defaults,R=Ve(r)||C(r)?w.delay:+r,M=Ve(o)||C(o)?1/0:+o,P=nt(u,w.loop),U=nt(f,w.loopDelay),k=P===!0||P===1/0||P<0?1/0:P+1;let D=0;e?D=i:(j.reqId||j.requestTick(oe()),D=(j._elapsedTime-j._startTime)*Z.timeScale),this.id=C(s)?++hr:s,this.parent=e,this.duration=yn((M+U)*k-U)||I,this.backwards=!1,this.paused=!0,this.began=!1,this.completed=!1,this.onBegin=x||w.onBegin,this.onBeforeUpdate=E||w.onBeforeUpdate,this.onUpdate=m||w.onUpdate,this.onLoop=g||w.onLoop,this.onPause=_||w.onPause,this.onComplete=p||w.onComplete,this.iterationDuration=M,this.iterationCount=k,this._autoplay=e?!1:nt(c,w.autoplay),this._offset=D,this._delay=R,this._loopDelay=U,this._iterationTime=0,this._currentIteration=0,this._resolve=mt,this._running=!1,this._reversed=+nt(l,w.reversed),this._reverse=this._reversed,this._cancelled=0,this._alternate=nt(a,w.alternate),this._prev=null,this._next=null,this._elapsedTime=y,this._startTime=y,this._lastTime=y,this._fps=nt(h,w.frameRate),this._speed=nt(d,w.playbackRate)}get cancelled(){return!!this._cancelled}set cancelled(t){t?this.cancel():this.reset(1).play()}get currentTime(){return Q(O(this._currentTime,Z.precision),-this._delay,this.duration)}set currentTime(t){const e=this.paused;this.pause().seek(+t),e||this.resume()}get iterationCurrentTime(){return O(this._iterationTime,Z.precision)}set iterationCurrentTime(t){this.currentTime=this.iterationDuration*this._currentIteration+t}get progress(){return Q(O(this._currentTime/this.duration,10),0,1)}set progress(t){this.currentTime=this.duration*t}get iterationProgress(){return Q(O(this._iterationTime/this.iterationDuration,10),0,1)}set iterationProgress(t){const e=this.iterationDuration;this.currentTime=e*this._currentIteration+e*t}get currentIteration(){return this._currentIteration}set currentIteration(t){this.currentTime=this.iterationDuration*Q(+t,0,this.iterationCount-1)}get reversed(){return!!this._reversed}set reversed(t){t?this.reverse():this.play()}get speed(){return super.speed}set speed(t){super.speed=t,this.resetTime()}reset(t=0){return fn(this),this._reversed&&!this._reverse&&(this.reversed=!1),this._iterationTime=this.iterationDuration,Kt(this,0,1,t,yt.FORCE),Qn(this),this._hasChildren&&$(this,Qn),this}init(t=0){this.fps=this._fps,this.speed=this._speed,!t&&this._hasChildren&&Kt(this,this.duration,1,t,yt.FORCE),this.reset(t);const e=this._autoplay;return e===!0?this.resume():e&&!C(e.linked)&&e.link(this),this}resetTime(){const t=1/(this._speed*j._speed);return this._startTime=oe()-(this._currentTime+this._delay)*t,this}pause(){return this.paused?this:(this.paused=!0,this.onPause(this),this)}resume(){return this.paused?(this.paused=!1,this.duration<=I&&!this._hasChildren?Kt(this,I,0,0,yt.FORCE):(this._running||(te(j,this),j._hasChildren=!0,this._running=!0),this.resetTime(),this._startTime-=12,j.wake()),this):this}restart(){return this.reset(0).resume()}seek(t,e=0,i=0){fn(this),this.completed=!1;const s=this.paused;return this.paused=!0,Kt(this,t+this._delay,~~e,~~i,yt.AUTO),s?this:this.resume()}alternate(){const t=this._reversed,e=this.iterationCount,i=this.iterationDuration,s=e===1/0?Ei(cn/i):e;return this._reversed=+(this._alternate&&!(s%2)?t:!t),e===1/0?this.iterationProgress=this._reversed?1-this.iterationProgress:this.iterationProgress:this.seek(i*s-this._currentTime),this.resetTime(),this}play(){return this._reversed&&this.alternate(),this.resume()}reverse(){return this._reversed||this.alternate(),this.resume()}cancel(){return this._hasChildren?$(this,t=>t.cancel(),!0):$(this,cr),this._cancelled=1,this.pause()}stretch(t){const e=this.duration,i=ye(t);if(e===i)return this;const s=t/e,r=t<=I;return this.duration=r?I:i,this.iterationDuration=r?I:ye(this.iterationDuration*s),this._offset*=s,this._delay*=s,this._loopDelay*=s,this}revert(){Kt(this,0,1,0,yt.AUTO);const t=this._autoplay;return t&&t.linked&&t.linked===this&&t.revert(),this.cancel()}complete(){return this.seek(this.duration).cancel()}then(t=mt){const e=this.then,i=()=>{this.then=null,t(this),this.then=e,this._resolve=mt};return new Promise(s=>(this._resolve=()=>s(i()),this.completed&&this._resolve(),this))}}const ue=n=>n,Pi=(n,t,e)=>(((1-3*e+3*t)*n+(3*e-6*t))*n+3*t)*n,dr=(n,t,e)=>{let i=0,s=1,r,o,l=0;do o=i+(s-i)/2,r=Pi(o,t,e)-n,r>0?s=o:i=o;while(qs(r)>1e-7&&++l<100);return o},pr=(n=.5,t=0,e=.5,i=1)=>n===t&&e===i?ue:s=>s===0||s===1?s:Pi(dr(s,n,e),t,i),gr=(n=10,t)=>{const e=t?Ws:Ei;return i=>e(Q(i,0,1)*n)*(1/n)},Ai=(...n)=>{const t=n.length;if(!t)return ue;const e=t-1,i=n[0],s=n[e],r=[0],o=[Ie(i)];for(let l=1;l<e;l++){const a=n[l],u=Ge(a)?a.trim().split(" "):[a],f=u[0],c=u[1];r.push(C(c)?l/e:Ie(c)/100),o.push(Ie(f))}return o.push(Ie(s)),r.push(1),function(a){for(let u=1,f=r.length;u<f;u++){const c=r[u];if(a<=c){const h=r[u-1],d=o[u-1];return d+(o[u]-d)*(a-h)/(c-h)}}return o[o.length-1]}},mr=(n=10,t=1)=>{const e=[0],i=n-1;for(let s=1;s<i;s++){const r=e[s-1],o=s/i,l=(s+1)/i,a=o+(l-o)*Math.random(),u=o*(1-t)+a*t;e.push(Q(u,r,1))}return e.push(1),Ai(...e)},yr=mn/2,Jn=mn*2,de=(n=1.68)=>t=>Jt(t,+n),Kn={[Gt]:de,Quad:de(2),Cubic:de(3),Quart:de(4),Quint:de(5),Sine:n=>1-Zs(n*yr),Circ:n=>1-Gs(1-n*n),Expo:n=>n?Jt(2,10*n-10):0,Bounce:n=>{let t,e=4;for(;n<((t=Jt(2,--e))-1)/11;);return 1/Jt(4,3-e)-7.5625*Jt((t*3-2)/22-n,2)},Back:(n=1.70158)=>t=>(+n+1)*t*t*t-+n*t*t,Elastic:(n=1,t=.3)=>{const e=Q(+n,1,10),i=Q(+t,I,2),s=i/Jn*Hs(1/e),r=Jn/i;return o=>o===0||o===1?o:-e*Jt(2,-10*(1-o))*Xs((1-o-s)*r)}},dn={in:n=>t=>n(t),out:n=>t=>1-n(1-t),inOut:n=>t=>t<.5?n(t*2)/2:1-n(t*-2+2)/2,outIn:n=>t=>t<.5?(1-n(1-t*2))/2:(n(t*2-1)+1)/2},xr=(n,t,e)=>{if(e[n])return e[n];if(n.indexOf("(")<=-1){const s=dn[n]||n.includes("Back")||n.includes("Elastic")?t[n]():t[n];return s?e[n]=s:ue}else{const i=n.slice(0,-1).split("("),s=t[i[0]];return s?e[n]=s(...i[1].split(",")):ue}},vr=(()=>{const n={linear:Ai,irregular:mr,steps:gr,cubicBezier:pr};for(let t in dn)for(let e in Kn){const i=Kn[e],s=dn[t];n[t+e]=e===Gt||e==="Back"||e==="Elastic"?(r,o)=>s(i(r,o)):s(i)}return n})(),_r={linear:ue},ti=n=>Ve(n)?n:Ge(n)?xr(n,vr,_r):ue,ei={},Er=(n,t,e)=>{if(e===B.TRANSFORM){const i=fi.get(n);return i||n}else if(e===B.CSS||e===B.ATTRIBUTE&&yi(t)&&n in t.style){const i=ei[n];if(i)return i;{const s=n&&Vs(n);return ei[n]=s,s}}else return n},tn={deg:1,rad:180/mn,turn:360},ni={},Tr=(n,t,e,i=!1)=>{const s=t.u,r=t.n;if(t.t===b.UNIT&&s===e)return t;const o=r+s+e,l=ni[o];if(!C(l)&&!i)t.n=l;else{let a;if(s in tn)a=r*tn[s]/tn[e];else{const f=n.cloneNode(),c=n.parentNode,h=c&&c!==Te?c:Te.body;h.appendChild(f);const d=f.style;d.width=100+s;const p=f.offsetWidth||100;d.width=100+e;const g=f.offsetWidth||100,_=p/g;h.removeChild(f),a=_*r}t.n=a,ni[o]=a}return t.t,b.UNIT,t.u=e,t},Li=n=>{if(n._hasChildren)$(n,Li,!0);else{const t=n;t.pause(),$(t,e=>{const i=e.property,s=e.target;if(s[gn]){const r=s.style,o=t._inlineStyles[i];if(e._tweenType===B.TRANSFORM){const l=s[$e];if(C(o)||o===Gt?delete l[i]:l[i]=o,e._renderTransforms)if(!Object.keys(l).length)r.removeProperty("transform");else{let a=Gt;for(let u in l)a+=pi[u]+l[u]+") ";r.transform=a}}else C(o)||o===Gt?r.removeProperty(i):r[i]=o;t._tail===e&&t.targets.forEach(l=>{l.getAttribute&&l.getAttribute("style")===Gt&&l.removeAttribute("style")})}})}return n},T=xn(),S=xn(),Ce={func:null},Me=[null],Qt=[null,null],Ne={to:null};let Sr=0,Ot,Rt;const wr=(n,t)=>{const e={};if(le(n)){const i=[].concat(...n.map(s=>Object.keys(s))).filter(De);for(let s=0,r=i.length;s<r;s++){const o=i[s],l=n.map(a=>{const u={};for(let f in a){const c=a[f];De(f)?f===o&&(u.to=c):u[f]=c}return u});e[o]=l}}else{const i=nt(t.duration,Z.defaults.duration);Object.keys(n).map(r=>({o:parseFloat(r)/100,p:n[r]})).sort((r,o)=>r.o-o.o).forEach(r=>{const o=r.o,l=r.p;for(let a in l)if(De(a)){let u=e[a];u||(u=e[a]=[]);const f=o*i;let c=u.length,h=u[c-1];const d={to:l[a]};let p=0;for(let g=0;g<c;g++)p+=u[g].duration;c===1&&(d.from=h.to),l.ease&&(d.ease=l.ease),d.duration=f-(c?p:0),u.push(d)}return r});for(let r in e){const o=e[r];let l;for(let a=0,u=o.length;a<u;a++){const f=o[a],c=f.ease;f.ease=l||void 0,l=c}o[0].duration||o.shift()}}return e};class br extends fr{constructor(t,e,i,s,r=!1,o=0,l=0){super(e,i,s);const a=nr(t),u=a.length,f=e.keyframes,c=f?Ys(wr(f,e),e):e,{delay:h,duration:d,ease:p,playbackEase:g,modifier:_,composition:x,onRender:E}=c,m=i?i.defaults:Z.defaults,y=nt(g,m.playbackEase),w=y?ti(y):null,R=!C(p)&&!C(p.ease),M=R?p.ease:nt(p,w?"linear":m.ease),P=R?p.duration:nt(d,m.duration),U=nt(h,m.delay),k=_||m.modifier,D=C(x)&&u>=re?lt.none:C(x)?m.composition:x,F={},q=this._offset+(i?i._offset:0);let G=NaN,V=NaN,ut=0,Pt=0;for(let J=0;J<u;J++){const v=a[J],W=o||J,at=l||u;let Zt=NaN,Vt=NaN;for(let ht in c)if(De(ht)){const it=bi(v,ht),ft=Er(ht,v,it);let ct=c[ht];const ae=le(ct);if(r&&!ae&&(Qt[0]=ct,Qt[1]=ct,ct=Qt),ae){const st=ct.length,xt=!je(ct[0]);st===2&&xt?(Ne.to=ct,Me[0]=Ne,Ot=Me):st>2&&xt?(Ot=[],ct.forEach((K,rt)=>{rt?rt===1?(Qt[1]=K,Ot.push(Qt)):Ot.push(K):Qt[0]=K})):Ot=ct}else Me[0]=ct,Ot=Me;let _t=null,dt=null,At=NaN,Lt=0,X=0;for(let st=Ot.length;X<st;X++){const xt=Ot[X];je(xt)?Rt=xt:(Ne.to=xt,Rt=Ne),Ce.func=null;const K=Mt(Rt.to,v,W,at,Ce);let rt;je(K)&&!C(K.to)?(Rt=K,rt=K.to):rt=K;const qt=Mt(Rt.from,v,W,at),Et=Rt.ease,ot=!C(Et)&&!C(Et.ease),Wt=ot?Et.ease:Et||M,z=ot?Et.duration:Mt(nt(Rt.duration,st>1?Mt(P,v,W,at)/st:P),v,W,at),Tt=Mt(nt(Rt.delay,X?0:U),v,W,at),St=Mt(nt(Rt.composition,D),v,W,at),It=zs(St)?St:lt[St],we=Rt.modifier||k,Ht=!C(qt),zt=!C(rt),be=le(rt),Ii=be||Ht&&zt,Xe=dt?Lt+Tt:Tt,Ze=O(q+Xe,12);!Pt&&(Ht||be)&&(Pt=1);let pt=dt;if(It!==lt.none){_t||(_t=vn(v,ft));let A=_t._head;for(;A&&!A._isOverridden&&A._absoluteStartTime<=Ze;)if(pt=A,A=A._nextRep,A&&A._absoluteStartTime>=Ze)for(;A;)Be(A),A=A._nextRep}if(Ii?(bt(be?Mt(rt[0],v,W,at):qt,T),bt(be?Mt(rt[1],v,W,at,Ce):rt,S),T.t===b.NUMBER&&(pt?pt._valueType===b.UNIT&&(T.t=b.UNIT,T.u=pt._unit):(bt(fe(v,ft,it,F),Nt),Nt.t===b.UNIT&&(T.t=b.UNIT,T.u=Nt.u)))):(zt?bt(rt,S):dt?jn(dt,S):bt(i&&pt&&pt.parent.parent===i?pt._value:fe(v,ft,it,F),S),Ht?bt(qt,T):dt?jn(dt,T):bt(i&&pt&&pt.parent.parent===i?pt._value:fe(v,ft,it,F),T)),T.o&&(T.n=Ke(pt?pt._toNumber:bt(fe(v,ft,it,F),Nt).n,T.n,T.o)),S.o&&(S.n=Ke(T.n,S.n,S.o)),T.t!==S.t){if(T.t===b.COMPLEX||S.t===b.COMPLEX){const A=T.t===b.COMPLEX?T:S,H=T.t===b.COMPLEX?S:T;H.t=b.COMPLEX,H.s=et(A.s),H.d=A.d.map(()=>H.n)}else if(T.t===b.UNIT||S.t===b.UNIT){const A=T.t===b.UNIT?T:S,H=T.t===b.UNIT?S:T;H.t=b.UNIT,H.u=A.u}else if(T.t===b.COLOR||S.t===b.COLOR){const A=T.t===b.COLOR?T:S,H=T.t===b.COLOR?S:T;H.t=b.COLOR,H.s=A.s,H.d=[0,0,0,1]}}if(T.u!==S.u){let A=S.u?T:S;A=Tr(v,A,S.u?S.u:T.u,!1)}if(S.d&&T.d&&S.d.length!==T.d.length){const A=T.d.length>S.d.length?T:S,H=A===T?S:T;H.d=A.d.map((Nr,_n)=>C(H.d[_n])?0:H.d[_n]),H.s=et(A.s)}const qe=O(+z||I,12),Re={parent:this,id:Sr++,property:ft,target:v,_value:null,_func:Ce.func,_ease:ti(Wt),_fromNumbers:et(T.d),_toNumbers:et(S.d),_strings:et(S.s),_fromNumber:T.n,_toNumber:S.n,_numbers:et(T.d),_number:T.n,_unit:S.u,_modifier:we,_currentTime:0,_startTime:Xe,_delay:+Tt,_updateDuration:qe,_changeDuration:qe,_absoluteStartTime:Ze,_tweenType:it,_valueType:S.t,_composition:It,_isOverlapped:0,_isOverridden:0,_renderTransforms:0,_prevRep:null,_nextRep:null,_prevAdd:null,_nextAdd:null,_prev:null,_next:null};It!==lt.none&&Ri(Re,_t),isNaN(At)&&(At=Re._startTime),Lt=O(Xe+qe,12),dt=Re,ut++,te(this,Re)}(isNaN(V)||At<V)&&(V=At),(isNaN(G)||Lt>G)&&(G=Lt),it===B.TRANSFORM&&(Zt=ut-X,Vt=ut)}if(!isNaN(Zt)){let ht=0;$(this,it=>{ht>=Zt&&ht<Vt&&(it._renderTransforms=1,it._composition===lt.blend&&$(ie.animation,ft=>{ft.id===it.id&&(ft._renderTransforms=1)})),ht++})}}u||console.warn("No target found. Make sure the element you're trying to animate is accessible before creating your animation."),V?($(this,J=>{J._startTime-J._delay||(J._delay-=V),J._startTime-=V}),G-=V):V=0,G||(G=I,this.iterationCount=0),this.targets=a,this.duration=G===I?I:yn((G+this._loopDelay)*this.iterationCount-this._loopDelay)||I,this.onRender=E||m.onRender,this._ease=w,this._delay=V,this.iterationDuration=G,this._inlineStyles=F,!this._autoplay&&Pt&&this.onRender(this)}stretch(t){const e=this.duration;if(e===ye(t))return this;const i=t/e;return $(this,s=>{s._updateDuration=ye(s._updateDuration*i),s._changeDuration=ye(s._changeDuration*i),s._currentTime*=i,s._startTime*=i,s._absoluteStartTime*=i}),super.stretch(t)}refresh(){return $(this,t=>{const e=t._func;if(e){const i=fe(t.target,t.property,t._tweenType);bt(i,Nt),bt(e(),S),t._fromNumbers=et(Nt.d),t._fromNumber=Nt.n,t._toNumbers=et(S.d),t._strings=et(S.s),t._toNumber=S.o?Ke(Nt.n,S.n,S.o):S.n}}),this}revert(){return super.revert(),Li(this)}then(t){return super.then(t)}}const ii=(n,t)=>new br(n,t,null,0,!1).init();window.polygonClipping=ge;const Rr=80,Pr=20,Ar=.95;class ee{constructor(t=[],e=!0,i=[],s=!1,r=!1,o=!1){this.points=t,this.uv=i.length>0?i:[],this.face=e,this.visible=!0,this.isCollision=s,this.isNegativeCollision=r,this.isMain=o,this.debugColor=[1,0,0,.4]}clone(){const t=new ee(this.points.map(e=>e.clone()),this.face,this.uv.map(e=>e.clone()),this.isCollision,this.isNegativeCollision,this.isMain);return t.debugColor=[...this.debugColor],t.visible=this.visible,t}}class Lr{constructor(t,e,i){this.overlapProgress=document.getElementById("overlap"),this.levelSelectContainer=document.getElementById("level-select"),this.winScreen=document.getElementById("win-screen"),this.nextLevelButton=document.getElementById("next-level-btn"),this.createLevelButtons(t.levels.length,e),this.nextLevelButton.addEventListener("click",i)}updateOverlapProgress(t){this.overlapProgress.value=Math.max(Math.round(t*100),0)}createLevelButtons(t,e){this.levelSelectContainer.innerHTML="";for(let i=0;i<t;i++){const s=document.createElement("button");s.className="level-btn",s.textContent=`关卡 ${i+1}`,s.addEventListener("click",()=>e(i)),this.levelSelectContainer.appendChild(s)}}setActiveButton(t){this.levelSelectContainer.querySelectorAll(".level-btn").forEach((i,s)=>{i.classList.toggle("active",s===t)})}showWinScreen(t){this.winScreen.classList.remove("hidden"),t?(this.nextLevelButton.hidden=!0,this.nextLevelButton.disabled=!0):(this.nextLevelButton.hidden=!1,this.nextLevelButton.disabled=!1);const e=document.querySelector("#win-message");ii(e,{translateX:["-50%","-50%"],translateY:["100vh","-50%"],opacity:[0,1],easing:"easeOutElastic(1, .7)",duration:1200,complete:()=>{setTimeout(()=>{ii(e,{translateY:["-50%","-200%"],opacity:[1,0],easing:"easeInBack",duration:800})},1500)}})}hideWinScreen(){this.winScreen.classList.add("hidden")}}class Ir{constructor(){this.layers=[],this.history=[]}getLayers(){return this.layers.map(t=>t.clone())}setLayers(t){this.layers=t}record(t,e){this.history.push({layers:this.getLayers(),from:t,to:e})}popHistory(){return this.history.length<=1?null:this.history.pop()??null}peekHistory(){return this.history.length===0?null:this.history[this.history.length-1]}hasHistory(){return this.history.length>1}clearHistory(){this.history.length=0,this.record()}}class Cr{constructor(t,e,i){this.canvas=t,this.game=e,this.dpr=i,this.bindEvents()}getMousePosition(t){const e=this.canvas.getBoundingClientRect();return new L((t.clientX-e.left)*this.dpr,(t.clientY-e.top)*this.dpr)}bindEvents(){this.canvas.addEventListener("mousedown",t=>{if(this.game.isInputLocked())return;const e=this.getMousePosition(t);this.game.isPointOnFoldableEdge(e)&&this.game.handleDragStart(e)}),this.canvas.addEventListener("mousemove",t=>{this.game.isDragging&&this.game.handleDragMove(this.getMousePosition(t))}),window.addEventListener("mouseup",()=>{this.game.isDragging&&this.game.handleDragEnd()}),document.addEventListener("keydown",t=>{this.game.isInputLocked()||(t.code==="Space"?(t.preventDefault(),this.game.reversePaper()):t.code==="KeyZ"?this.game.undoFold():t.code==="KeyR"&&this.game.restartLevel())})}}class Mr{constructor(t){this.running=!0,this.dpr=window.devicePixelRatio,this.currentLevelIndex=0,this.tempLayers=null,this.fullShape=[],this.isRevoking=!1,this.revokeBaseLayers=null,this.revokeFrom=null,this.revokeAnimPos=null,this.isWin=!1,this.isDragging=!1,this.dragStartPos=null,this.dragEndPos=null,this.canvas=t,this.renderer=new ts(t),Ls(this).then(e=>{this.levels=e,this.state=new Ir,this.ui=new Lr(this,this.loadLevelByIndex.bind(this),this.loadNextLevel.bind(this)),this.input=new Cr(t,this,this.dpr),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.loadLevelByIndex(0),document.getElementById("loading").remove(),requestAnimationFrame(this.loop.bind(this))}),window.z=this}isInputLocked(){return this.isWin||this.isRevoking}loadLevelByIndex(t){const e=this.levels;t<0||t>=e.length||(this.currentLevelIndex=t,this.isWin=!1,this.isDragging=!1,this.tempLayers=null,this.ui.hideWinScreen(),this.ui.setActiveButton(t),this.loadLevel(e[t]),this.state.clearHistory(),this.updateFullShape(),this.updateScore())}restartLevel(){this.loadLevelByIndex(this.currentLevelIndex)}loadNextLevel(){this.loadLevelByIndex(this.currentLevelIndex+1)}loadLevel(t){const e=[],i=new ee(t.paper.points,!0,t.paper.uvs,!1,!1,!0);for(const r of t.positiveShapes){const o=new ee(r,!1);o.debugColor=[.7,.7,.7,1],e.push(o)}e.push(i);let s=ce(i.points);for(const r of t.positiveShapes){const o=new ee(r,!0,[],!0);e.push(o),s=ge.difference(s,ce(r))}for(const r of wn(s))for(const o of r){const l=new ee(Ln(o),!0,[],!1,!0);l.visible=!1,e.push(l)}this.state.setLayers(e),this.state.texture1=t.texture1,this.state.texture2=t.texture2}loop(){this.running&&(this.update(),this.render(),requestAnimationFrame(this.loop.bind(this)))}update(){this.isRevoking&&this.handleRevokeAnimation()}render(){this.renderer.startRender(),this.renderer.render(this.isWin,this.tempLayers??this.state.layers,this.isWin?this.state.texture2:this.state.texture1),this.renderer.endRender()}fold(t,e,i){const s=[],r=t.add(e).divideScalar(2);for(let o=i.length-1;o>=0;o--){const l=i[o],{reflectedPolygon:a,reflectedUVs:u,otherPolygon:f,otherUVs:c}=Hi(l.points,l.uv,t,r);if(f.length===0?i.splice(o,1):(l.points=f,l.uv=c),a.length>0){const h=l.clone();h.face=!l.face,h.points=a,h.uv=u,s.push(h)}}return[...i,...s]}handleDragStart(t){this.isDragging=!0,this.dragStartPos=t,this.dragEndPos=t.clone(),this.tempLayers=this.state.getLayers()}handleDragMove(t){this.dragEndPos=t,this.tempLayers=this.fold(this.dragStartPos,this.dragEndPos,this.state.getLayers()),this.updateScore(this.tempLayers)}handleDragEnd(){const t=this.fold(this.dragStartPos,this.dragEndPos,this.state.getLayers());this.state.setLayers(t),this.state.record(this.dragStartPos,this.dragEndPos),this.isDragging=!1,this.tempLayers=null,this.dragStartPos=null,this.dragEndPos=null,this.updateScore(),this.checkWinCondition(),this.updateFullShape()}undoFold(){if(this.isRevoking)return;const t=this.state.popHistory();if(!t||!t.from||!t.to)return;const e=this.state.peekHistory();if(!e){this.state.record(t.from,t.to),this.state.setLayers(t.layers);return}this.isRevoking=!0,this.revokeBaseLayers=e.layers.map(i=>i.clone()),this.revokeFrom=t.from,this.revokeAnimPos=t.to}handleRevokeAnimation(){!this.revokeBaseLayers||!this.revokeFrom||!this.revokeAnimPos||(this.revokeAnimPos=this.revokeAnimPos.moveTowards(this.revokeFrom,Pr),this.tempLayers=this.fold(this.revokeFrom,this.revokeAnimPos,this.revokeBaseLayers.map(t=>t.clone())),this.revokeAnimPos.equals(this.revokeFrom)&&(this.isRevoking=!1,this.tempLayers=null,this.state.setLayers(this.revokeBaseLayers),this.revokeBaseLayers=null,this.revokeFrom=null,this.revokeAnimPos=null,this.updateScore(),this.updateFullShape(),this.checkWinCondition()))}reversePaper(){const t=this.state.layers;t.forEach(e=>{e.face=!e.face}),t.reverse(),this.state.setLayers(t),this.updateScore(),this.checkWinCondition()}updateFullShape(){let t=null;for(const e of this.state.layers){if(e.isCollision||e.isNegativeCollision)continue;const i=Yt(ce(e.points));t=t?ge.union(Yt(t),i):i}this.fullShape=t?wn(t).map(e=>Ln(e[0])):[]}isPointOnFoldableEdge(t){return this.isInputLocked()?!1:this.fullShape.some(e=>ui(t,e)&&Yi(t,e,Rr))}win(){this.isWin=!0;const t=this.currentLevelIndex===this.levels.length-1;this.ui.showWinScreen(t);const e=setInterval(()=>{this.state.hasHistory()&&!this.isRevoking?this.undoFold():!this.state.hasHistory()&&!this.isRevoking&&clearInterval(e)},200)}updateScore(t=this.state.layers){const e=this.calculateOverlapScore(t);this.ui.updateOverlapProgress(e)}checkWinCondition(t=this.state.layers){if(this.isWin)return;this.calculateOverlapScore(t)>Ar&&this.win()}calculateOverlapScore(t){let e=0,i=0,s=0,r=0;for(const a of t)if(a.isCollision){const{rate:u,area:f}=this.getOverlapRate(a,t);s+=f,e+=u*f}else if(a.isNegativeCollision){const{rate:u,area:f}=this.getOverlapRate(a,t);r+=f,i+=u*f}const o=s>0?e/s:1,l=r>0?i/r:0;return o-l}getOverlapRate(t,e){const i=ce(t.points),s=Pn(i);if(s===0)return{rate:0,area:0};if(!t.face)return{rate:1,area:s};const r=e.findIndex(a=>a===t),o=e.slice(r+1);let l=null;for(const a of o){if(a.isCollision||a.isNegativeCollision)continue;const u=ce(a.points);l=l?ge.union(Yt(l),Yt(u)):u}if(l){const a=ge.intersection(Yt(i),Yt(l));return{rate:Pn(a)/s,area:s}}return{rate:0,area:s}}resizeCanvas(){const t=window.innerWidth,e=window.innerHeight;this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr,this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`,this.renderer.resize(this.canvas.width,this.canvas.height)}destroy(){this.running=!1}}new Mr(document.getElementById("game"));
